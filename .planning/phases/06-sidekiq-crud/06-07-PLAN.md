---
phase: 06-sidekiq-crud
plan: 07
type: execute
wave: 4
depends_on: ["06-03", "06-05", "06-06"]
files_modified:
  - sidekiq-webapp/src/app/(dashboard)/sidekiqs/[id]/edit/page.tsx
  - sidekiq-webapp/src/app/(dashboard)/sidekiqs/[id]/edit/layout.tsx
  - sidekiq-webapp/src/components/sidekiq/sidekiq-form.tsx
  - sidekiq-webapp/src/components/sidekiq/starter-templates.tsx
autonomous: false

must_haves:
  truths:
    - "User can navigate to /sidekiqs/[id]/edit and edit their Sidekiq"
    - "Form loads with existing Sidekiq data"
    - "User can save changes successfully"
    - "User can use starter templates when creating"
    - "Breadcrumb shows: Sidekiqs > [Name] > Edit"
  artifacts:
    - path: "sidekiq-webapp/src/app/(dashboard)/sidekiqs/[id]/edit/page.tsx"
      provides: "Edit Sidekiq page"
      min_lines: 40
    - path: "sidekiq-webapp/src/components/sidekiq/starter-templates.tsx"
      provides: "Pre-built Sidekiq templates"
      exports: ["StarterTemplates", "SIDEKIQ_TEMPLATES"]
  key_links:
    - from: "sidekiq-webapp/src/app/(dashboard)/sidekiqs/[id]/edit/page.tsx"
      to: "api.sidekiq.getById"
      via: "tRPC query"
      pattern: "api\\.sidekiq\\.getById"
    - from: "sidekiq-webapp/src/app/(dashboard)/sidekiqs/[id]/edit/page.tsx"
      to: "sidekiq-webapp/src/components/sidekiq/sidekiq-form.tsx"
      via: "form with initialData"
      pattern: "SidekiqForm.*mode=\"edit\""
---

<objective>
Create the edit page and add starter templates for new Sidekiqs.

Purpose: Enables editing existing Sidekiqs and provides templates to help users get started quickly.
Output: /sidekiqs/[id]/edit page, starter templates on create page, final polish and verification.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/06-sidekiq-crud/06-CONTEXT.md
@.planning/phases/06-sidekiq-crud/06-RESEARCH.md
@.planning/phases/06-sidekiq-crud/06-04-SUMMARY.md
@.planning/phases/06-sidekiq-crud/06-05-SUMMARY.md
@.planning/phases/06-sidekiq-crud/06-06-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create starter templates component</name>
  <files>sidekiq-webapp/src/components/sidekiq/starter-templates.tsx</files>
  <action>
Create the starter templates component with 6-8 templates:

```typescript
"use client";

import { Code, FileText, Lightbulb, Palette, Search, BookOpen, Brain, MessageSquare } from "lucide-react";

import { Button } from "@sidekiq/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@sidekiq/components/ui/card";
import type { CreateSidekiqInput } from "@sidekiq/lib/validations/sidekiq";

interface Template {
  id: string;
  name: string;
  description: string;
  icon: React.ComponentType<{ className?: string }>;
  data: Partial<CreateSidekiqInput>;
}

/**
 * Pre-built Sidekiq templates for common use cases.
 */
export const SIDEKIQ_TEMPLATES: Template[] = [
  {
    id: "writing",
    name: "Writing Assistant",
    description: "Help with writing, editing, and proofreading",
    icon: FileText,
    data: {
      name: "Writing Assistant",
      description: "A helpful writing companion for drafting, editing, and polishing your content",
      instructions: `You are a skilled writing assistant. Your role is to help users with:

- Drafting and writing content (blog posts, emails, articles, etc.)
- Editing and proofreading for clarity, grammar, and style
- Suggesting improvements to structure and flow
- Adapting tone for different audiences
- Brainstorming ideas and outlines

Be constructive in feedback, offer specific suggestions, and maintain the user's voice while improving their writing.`,
      conversationStarters: [
        "Help me write a professional email",
        "Review and edit my blog post draft",
        "Brainstorm ideas for an article about...",
        "Make this paragraph more concise",
      ],
      avatar: { type: "emoji" as const, color: "#3b82f6", emoji: "âœï¸" },
    },
  },
  {
    id: "coding",
    name: "Coding Helper",
    description: "Technical assistance for programming tasks",
    icon: Code,
    data: {
      name: "Coding Helper",
      description: "Your pair programming buddy for debugging, code review, and learning",
      instructions: `You are an experienced software developer and coding assistant. Help users with:

- Writing and debugging code in various languages
- Explaining programming concepts clearly
- Code review and suggesting improvements
- Best practices and design patterns
- Problem-solving and algorithm design

Always explain your reasoning, provide working code examples, and consider edge cases. Prioritize clean, maintainable code.`,
      conversationStarters: [
        "Debug this code for me",
        "Explain how async/await works",
        "Review my function for improvements",
        "Help me write a unit test for...",
      ],
      avatar: { type: "emoji" as const, color: "#22c55e", emoji: "ðŸ’»" },
    },
  },
  {
    id: "research",
    name: "Research Analyst",
    description: "Deep dive into topics and synthesize information",
    icon: Search,
    data: {
      name: "Research Analyst",
      description: "Thorough researcher for investigating topics and providing comprehensive analysis",
      instructions: `You are a meticulous research analyst. Your approach:

- Break down complex topics into understandable parts
- Consider multiple perspectives and sources
- Identify key findings and insights
- Present information in a structured, logical way
- Acknowledge limitations and uncertainties

Provide thorough, well-organized responses. Cite reasoning clearly and distinguish between facts and analysis.`,
      conversationStarters: [
        "Research the pros and cons of...",
        "Compare these two approaches",
        "Summarize the key points about...",
        "What are the latest trends in...",
      ],
      avatar: { type: "emoji" as const, color: "#6366f1", emoji: "ðŸ”" },
    },
  },
  {
    id: "creative",
    name: "Creative Muse",
    description: "Spark creativity and generate ideas",
    icon: Palette,
    data: {
      name: "Creative Muse",
      description: "Your creative partner for brainstorming, storytelling, and artistic inspiration",
      instructions: `You are a creative collaborator with an imaginative spirit. Help users with:

- Brainstorming and generating novel ideas
- Creative writing and storytelling
- Thinking outside the box
- Exploring different artistic directions
- Building on and expanding concepts

Be enthusiastic, offer unexpected connections, and encourage experimentation. Push boundaries while respecting the user's creative vision.`,
      conversationStarters: [
        "I need creative ideas for...",
        "Help me write a short story about...",
        "What are some unique ways to...",
        "Let's brainstorm names for...",
      ],
      avatar: { type: "emoji" as const, color: "#a855f7", emoji: "ðŸŽ¨" },
    },
  },
  {
    id: "tutor",
    name: "Learning Tutor",
    description: "Patient teacher for learning new concepts",
    icon: BookOpen,
    data: {
      name: "Learning Tutor",
      description: "A patient educator who adapts to your learning style and pace",
      instructions: `You are an encouraging tutor dedicated to helping people learn. Your approach:

- Explain concepts clearly, starting from fundamentals
- Use analogies and real-world examples
- Break complex topics into manageable steps
- Check understanding with questions
- Celebrate progress and encourage curiosity

Adapt your explanations to the learner's level. Be patient, supportive, and make learning enjoyable.`,
      conversationStarters: [
        "Explain this concept in simple terms",
        "Quiz me on what I've learned",
        "I don't understand this part...",
        "Teach me the basics of...",
      ],
      avatar: { type: "emoji" as const, color: "#f59e0b", emoji: "ðŸ“š" },
    },
  },
  {
    id: "brainstorm",
    name: "Idea Generator",
    description: "Generate and explore possibilities",
    icon: Lightbulb,
    data: {
      name: "Idea Generator",
      description: "Endless fountain of ideas and possibilities for any challenge",
      instructions: `You are an idea machine - energetic and full of possibilities. Help users by:

- Generating many diverse ideas quickly
- Building on and combining concepts
- Exploring unconventional approaches
- Asking "what if" questions
- Finding creative solutions to constraints

Quantity breeds quality. Offer lots of options, encourage wild ideas, and help refine the best ones.`,
      conversationStarters: [
        "Give me 10 ideas for...",
        "How could I approach this differently?",
        "What if we combined X and Y?",
        "Help me solve this creative challenge",
      ],
      avatar: { type: "emoji" as const, color: "#f97316", emoji: "ðŸ’¡" },
    },
  },
  {
    id: "analyst",
    name: "Strategic Thinker",
    description: "Structured analysis and decision support",
    icon: Brain,
    data: {
      name: "Strategic Thinker",
      description: "Analytical partner for making well-reasoned decisions",
      instructions: `You are a strategic analyst who helps with structured thinking. Your approach:

- Break down problems systematically
- Identify key factors and trade-offs
- Consider short and long-term implications
- Present balanced perspectives
- Support decision-making with clear frameworks

Be logical, thorough, and help users think through complex situations clearly.`,
      conversationStarters: [
        "Help me decide between these options",
        "What are the risks of...",
        "Analyze the pros and cons",
        "Create a framework for evaluating...",
      ],
      avatar: { type: "emoji" as const, color: "#14b8a6", emoji: "ðŸ§ " },
    },
  },
  {
    id: "conversational",
    name: "Friendly Chat",
    description: "Casual conversation and general assistance",
    icon: MessageSquare,
    data: {
      name: "Friendly Chat",
      description: "A friendly companion for everyday conversations and questions",
      instructions: `You are a warm, friendly conversationalist. Your personality:

- Engaging and genuinely interested
- Helpful but not overly formal
- Good sense of humor when appropriate
- Adaptable to the user's mood
- Supportive and encouraging

Be natural, relatable, and enjoyable to talk with. Help with anything asked while maintaining a friendly tone.`,
      conversationStarters: [
        "What should I do today?",
        "Tell me something interesting",
        "I need advice about...",
        "Let's chat about...",
      ],
      avatar: { type: "emoji" as const, color: "#ec4899", emoji: "ðŸ˜Š" },
    },
  },
];

interface StarterTemplatesProps {
  onSelect: (template: Template) => void;
}

/**
 * Grid of starter templates for creating new Sidekiqs.
 */
export function StarterTemplates({ onSelect }: StarterTemplatesProps) {
  return (
    <div className="space-y-4">
      <div>
        <h3 className="text-lg font-semibold">Start with a template</h3>
        <p className="text-sm text-muted-foreground">
          Choose a template to get started quickly, or create from scratch
        </p>
      </div>
      <div className="grid gap-4 sm:grid-cols-2 lg:grid-cols-4">
        {SIDEKIQ_TEMPLATES.map((template) => {
          const Icon = template.icon;
          return (
            <Card
              key={template.id}
              className="cursor-pointer transition-colors hover:bg-accent/50"
              onClick={() => onSelect(template)}
            >
              <CardHeader className="pb-2">
                <div className="flex items-center gap-2">
                  <div
                    className="flex size-8 items-center justify-center rounded-lg"
                    style={{ backgroundColor: template.data.avatar?.color }}
                  >
                    {template.data.avatar?.emoji ? (
                      <span className="text-sm">{template.data.avatar.emoji}</span>
                    ) : (
                      <Icon className="size-4 text-white" />
                    )}
                  </div>
                  <CardTitle className="text-sm">{template.name}</CardTitle>
                </div>
              </CardHeader>
              <CardContent className="pt-0">
                <CardDescription className="text-xs">
                  {template.description}
                </CardDescription>
              </CardContent>
            </Card>
          );
        })}
      </div>
    </div>
  );
}
```
  </action>
  <verify>
```bash
cd sidekiq-webapp && pnpm tsc --noEmit
```
  </verify>
  <done>
StarterTemplates component with 8 pre-built templates for common use cases. Each template includes name, description, instructions, starters, and avatar.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create edit page</name>
  <files>
sidekiq-webapp/src/app/(dashboard)/sidekiqs/[id]/edit/page.tsx
sidekiq-webapp/src/app/(dashboard)/sidekiqs/[id]/edit/layout.tsx
  </files>
  <action>
Create the edit page:

**1. Create `src/app/(dashboard)/sidekiqs/[id]/edit/layout.tsx`:**

```typescript
import type { Metadata } from "next";

export const metadata: Metadata = {
  title: "Edit Sidekiq | Sidekiq",
  description: "Edit your custom AI assistant",
};

export default function EditSidekiqLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return <>{children}</>;
}
```

**2. Create `src/app/(dashboard)/sidekiqs/[id]/edit/page.tsx`:**

```typescript
"use client";

import { use } from "react";
import Link from "next/link";
import { notFound } from "next/navigation";
import { ChevronRight, Loader2 } from "lucide-react";

import {
  Breadcrumb,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbList,
  BreadcrumbPage,
  BreadcrumbSeparator,
} from "@sidekiq/components/ui/breadcrumb";
import { SidekiqForm } from "@sidekiq/components/sidekiq/sidekiq-form";
import { api } from "@sidekiq/trpc/react";

interface EditSidekiqPageProps {
  params: Promise<{ id: string }>;
}

/**
 * Edit Sidekiq page.
 * Loads existing Sidekiq data and displays form for editing.
 * Breadcrumb: Sidekiqs > [Name] > Edit
 */
export default function EditSidekiqPage({ params }: EditSidekiqPageProps) {
  const { id } = use(params);

  const { data: sidekiq, isLoading, error } = api.sidekiq.getById.useQuery(
    { id },
    {
      retry: false,
    }
  );

  if (error?.data?.code === "NOT_FOUND") {
    notFound();
  }

  if (isLoading) {
    return (
      <div className="container max-w-6xl py-8">
        <div className="flex items-center justify-center py-16">
          <Loader2 className="size-8 animate-spin text-muted-foreground" />
        </div>
      </div>
    );
  }

  if (!sidekiq) {
    return (
      <div className="container max-w-6xl py-8">
        <div className="text-center py-16">
          <p className="text-muted-foreground">Sidekiq not found</p>
        </div>
      </div>
    );
  }

  return (
    <div className="container max-w-6xl py-8">
      {/* Breadcrumb */}
      <Breadcrumb className="mb-6">
        <BreadcrumbList>
          <BreadcrumbItem>
            <BreadcrumbLink asChild>
              <Link href="/sidekiqs">Sidekiqs</Link>
            </BreadcrumbLink>
          </BreadcrumbItem>
          <BreadcrumbSeparator>
            <ChevronRight className="size-4" />
          </BreadcrumbSeparator>
          <BreadcrumbItem>
            <BreadcrumbLink asChild>
              <Link href={`/sidekiqs/${id}/edit`}>{sidekiq.name}</Link>
            </BreadcrumbLink>
          </BreadcrumbItem>
          <BreadcrumbSeparator>
            <ChevronRight className="size-4" />
          </BreadcrumbSeparator>
          <BreadcrumbItem>
            <BreadcrumbPage>Edit</BreadcrumbPage>
          </BreadcrumbItem>
        </BreadcrumbList>
      </Breadcrumb>

      {/* Header */}
      <div className="mb-8">
        <h1 className="text-3xl font-bold">Edit Sidekiq</h1>
        <p className="text-muted-foreground mt-1">
          Update your Sidekiq&apos;s configuration
        </p>
      </div>

      {/* Form with initialData */}
      <SidekiqForm
        mode="edit"
        initialData={{
          id: sidekiq.id,
          name: sidekiq.name,
          description: sidekiq.description ?? "",
          instructions: sidekiq.instructions,
          conversationStarters: (sidekiq.conversationStarters as string[]) ?? [],
          defaultModel: sidekiq.defaultModel,
          avatar: sidekiq.avatar as {
            type: "initials" | "emoji";
            color: string;
            emoji?: string;
          },
        }}
      />
    </div>
  );
}
```
  </action>
  <verify>
1. Start dev server
2. Create a Sidekiq
3. Navigate to /sidekiqs/[id]/edit
4. Verify form loads with existing data
5. Make changes and save
  </verify>
  <done>
Edit page created with data loading, breadcrumb navigation, and form pre-populated with existing Sidekiq data.
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate templates into create page</name>
  <files>
sidekiq-webapp/src/app/(dashboard)/sidekiqs/new/page.tsx
sidekiq-webapp/src/components/sidekiq/sidekiq-form.tsx
  </files>
  <action>
**1. Update create page to show templates:**

Update `src/app/(dashboard)/sidekiqs/new/page.tsx`:

```typescript
"use client";

import { useState } from "react";
import Link from "next/link";
import { ChevronRight } from "lucide-react";

import {
  Breadcrumb,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbList,
  BreadcrumbPage,
  BreadcrumbSeparator,
} from "@sidekiq/components/ui/breadcrumb";
import { Button } from "@sidekiq/components/ui/button";
import { SidekiqForm } from "@sidekiq/components/sidekiq/sidekiq-form";
import { StarterTemplates, SIDEKIQ_TEMPLATES } from "@sidekiq/components/sidekiq/starter-templates";
import type { CreateSidekiqInput } from "@sidekiq/lib/validations/sidekiq";

type Template = (typeof SIDEKIQ_TEMPLATES)[number];

/**
 * Create Sidekiq page.
 * Shows templates first, then form when template selected or "Start from scratch".
 */
export default function CreateSidekiqPage() {
  const [selectedTemplate, setSelectedTemplate] = useState<Template | null>(null);
  const [showForm, setShowForm] = useState(false);

  const handleTemplateSelect = (template: Template) => {
    setSelectedTemplate(template);
    setShowForm(true);
  };

  const handleStartFromScratch = () => {
    setSelectedTemplate(null);
    setShowForm(true);
  };

  const handleBack = () => {
    setShowForm(false);
    setSelectedTemplate(null);
  };

  return (
    <div className="container max-w-6xl py-8">
      {/* Breadcrumb */}
      <Breadcrumb className="mb-6">
        <BreadcrumbList>
          <BreadcrumbItem>
            <BreadcrumbLink asChild>
              <Link href="/sidekiqs">Sidekiqs</Link>
            </BreadcrumbLink>
          </BreadcrumbItem>
          <BreadcrumbSeparator>
            <ChevronRight className="size-4" />
          </BreadcrumbSeparator>
          <BreadcrumbItem>
            <BreadcrumbPage>Create New</BreadcrumbPage>
          </BreadcrumbItem>
        </BreadcrumbList>
      </Breadcrumb>

      {/* Header */}
      <div className="mb-8">
        <h1 className="text-3xl font-bold">Create Sidekiq</h1>
        <p className="text-muted-foreground mt-1">
          {showForm
            ? "Define your custom AI assistant's personality and behavior"
            : "Choose a template or start from scratch"}
        </p>
      </div>

      {showForm ? (
        <>
          {/* Back button */}
          <Button
            variant="ghost"
            size="sm"
            onClick={handleBack}
            className="mb-4"
          >
            <ChevronRight className="mr-1 size-4 rotate-180" />
            Back to templates
          </Button>

          {/* Form */}
          <SidekiqForm
            mode="create"
            initialData={selectedTemplate?.data as Partial<CreateSidekiqInput>}
          />
        </>
      ) : (
        <div className="space-y-8">
          {/* Templates */}
          <StarterTemplates onSelect={handleTemplateSelect} />

          {/* Start from scratch */}
          <div className="flex items-center gap-4">
            <div className="h-px flex-1 bg-border" />
            <span className="text-sm text-muted-foreground">or</span>
            <div className="h-px flex-1 bg-border" />
          </div>

          <div className="text-center">
            <Button variant="outline" onClick={handleStartFromScratch}>
              Start from scratch
            </Button>
          </div>
        </div>
      )}
    </div>
  );
}
```

Note: The create page is now a client component because it manages local state for template selection.
  </action>
  <verify>
1. Navigate to /sidekiqs/new
2. Templates grid shows 8 options
3. Click template - form shows with template data
4. Click "Back to templates" - returns to selection
5. Click "Start from scratch" - shows empty form
  </verify>
  <done>
Create page updated with template selection. Users can choose from 8 templates or start from scratch. Template data pre-fills the form.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Sidekiq CRUD functionality:
- Schema extended with new fields (avatar, conversationStarters, etc.)
- tRPC router with all mutations and rate limiting
- /sidekiqs list page with grid/list view toggle
- /sidekiqs/new create page with templates
- /sidekiqs/[id]/edit page
- Drag-and-drop conversation starters
- Markdown instructions with preview
- Avatar customization (color + emoji)
- Delete dialog with type-to-confirm
- Sidebar Sidekiqs section
  </what-built>
  <how-to-verify>
1. Start the dev server: `cd sidekiq-webapp && pnpm dev`
2. Navigate to /sidekiqs - should show empty state or list

**Test Create Flow:**
3. Click "Create Sidekiq" or "Create first" button
4. Select a template (e.g., "Writing Assistant")
5. Verify form is pre-filled with template data
6. Test avatar picker - change color and switch to emoji
7. Add a conversation starter - verify drag handle works
8. Toggle markdown preview in instructions
9. Save the Sidekiq - should redirect to edit page

**Test List & Actions:**
10. Go back to /sidekiqs - new Sidekiq appears
11. Toggle grid/list view - should persist on refresh
12. Star the Sidekiq (favorite) - star icon appears
13. Use dropdown menu to duplicate - creates "Copy of [Name]"
14. Open delete dialog - type exact name to confirm

**Test Edit Flow:**
15. Click a Sidekiq card to edit
16. Breadcrumb shows: Sidekiqs > [Name] > Edit
17. Make changes and save - toast confirms success
18. Navigate away with unsaved changes - browser warning appears

**Test Sidebar:**
19. Check sidebar shows Sidekiqs section
20. Favorited Sidekiq appears with star
21. "See all" link navigates to /sidekiqs
22. Click Sidekiq in sidebar - navigates to /chat?sidekiq=id
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. All 8 requirements covered:
   - KIQQ-01: Create with name, description, instructions (done)
   - KIQQ-02: Edit Sidekiq (done)
   - KIQQ-03: Delete Sidekiq (done)
   - KIQQ-06: Text initial avatars (done)
   - KIQQ-07: 100 Sidekiqs limit (deferred per CONTEXT.md)
   - KIQQ-08: Rate limiting (done - 25/hour)
   - KIQQ-09: Instructions validation (done - 8000 chars)
   - KIQQ-10: Empty state CTA (done)
2. TypeScript compiles without errors
3. All pages load correctly
4. Form validation works
5. CRUD operations succeed
6. Sidebar integration complete
</verification>

<success_criteria>
- /sidekiqs page shows list with grid/list toggle
- /sidekiqs/new shows templates, then form
- /sidekiqs/[id]/edit loads and saves Sidekiq data
- Avatar picker works with color and emoji
- Conversation starters support drag-and-drop
- Instructions have markdown preview
- Delete dialog requires typing exact name
- Sidebar shows favorites and recent Sidekiqs
- Rate limiting blocks excessive creates (25/hour)
</success_criteria>

<output>
After completion, create `.planning/phases/06-sidekiq-crud/06-07-SUMMARY.md`
</output>
