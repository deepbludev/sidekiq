# Phase 8.2: Two-Tier Sidebar Navigation Architecture - Research

**Researched:** 2026-01-26
**Domain:** Two-tier sidebar navigation (icon rail + contextual panels), CSS layout, route-based panel switching
**Confidence:** HIGH

## Summary

This phase refactors the existing single-panel sidebar into a two-tier navigation architecture consisting of a permanent thin icon rail (~48px) for top-level feature switching and contextual secondary panels that display content per feature. The current sidebar already has a collapsed icon rail (w-16/64px) and expanded state (w-72/288px), but the two-tier architecture fundamentally changes the model: the icon rail is always visible alongside the secondary panel, rather than being an alternative collapsed view.

The existing codebase has 11 sidebar component files built with custom React components, TailwindCSS, Radix primitives, and TanStack Virtual. The project does NOT use the shadcn/ui Sidebar component (`sidebar.tsx` is not installed) and does NOT use Framer Motion. The recommended approach is to build the two-tier layout as a custom flexbox composition rather than adopting shadcn's Sidebar component, since the existing components are mature, well-tested, and the shadcn Sidebar's opinionated `SidebarProvider`/`SidebarInset` pattern would require invasive layout restructuring with minimal benefit for this specific use case.

The locked decisions from CONTEXT.md constrain the architecture: route-based panel switching (URL determines active panel), no secondary panel for Settings (navigates to /settings full page), and mobile uses a bottom tab bar with full-screen overlays rather than the current sheet drawer.

**Primary recommendation:** Build the two-tier sidebar as a custom flexbox layout (icon rail + panel container) using existing components, with route-based panel switching via `usePathname()`, CSS `transition-all` for panel animations, and a new mobile bottom tab bar replacing the current hamburger/Sheet pattern.

## Standard Stack

### Core (already in project -- no new dependencies needed)

| Library | Version | Purpose | Why Standard |
|---------|---------|---------|--------------|
| React | ^19.0.0 | Component architecture | Already in project |
| Next.js | ^15.2.3 | Routing (`usePathname`, `useRouter`) | Route-based panel switching |
| TailwindCSS | ^4.0.15 | Styling, transitions, responsive breakpoints | Already styling all sidebar components |
| @tanstack/react-virtual | ^3.13.18 | Virtualized thread list | Already used in sidebar-thread-list.tsx |
| @radix-ui/react-tooltip | ^1.2.8 | Icon rail tooltips | Already used for collapsed sidebar tooltips |
| @radix-ui/react-collapsible | ^1.1.12 | Collapsible sections within panels | Already used in sidebar-sidekiqs/teams |
| lucide-react | ^0.562.0 | Icons for rail items | Already in project |
| fuse.js | ^7.1.0 | Search within panels | Already used in thread search |

### Supporting (already in project)

| Library | Version | Purpose | When to Use |
|---------|---------|---------|-------------|
| @radix-ui/react-separator | ^1.1.8 | Rail-to-panel divider | Visual separation between rail and panel |
| tw-animate-css | ^1.4.0 | CSS animation utilities | Panel entry/exit animations |
| cmdk | ^1.1.1 | Command palette | Already used for SidekiqPicker, potential panel switching shortcut |

### Alternatives Considered

| Instead of | Could Use | Tradeoff |
|------------|-----------|----------|
| Custom flexbox layout | shadcn/ui Sidebar component | shadcn Sidebar requires `SidebarProvider` wrapping the entire layout, cookie-based state persistence, and `SidebarInset` for main content. Would require invasive restructuring of chat/layout.tsx for marginal benefit since the project already has a mature custom sidebar. |
| CSS transitions | Framer Motion / Motion | Framer Motion provides `AnimatePresence` for enter/exit animations and `layout` animations. However, CSS `transition-all` on `transform`/`opacity` is sufficient for panel crossfade/slide effects, avoiding a ~30KB dependency. |
| Custom bottom tab bar | react-native-tab-view or similar | This is a web app; a simple fixed-bottom flex row with TailwindCSS is more appropriate than a native-oriented library. |

**Installation:**
```bash
# No new packages needed - everything is already in the project
```

## Architecture Patterns

### Recommended Project Structure

```
src/components/sidebar/
  sidebar-layout.tsx          # NEW: Two-tier container (icon rail + panel)
  sidebar-icon-rail.tsx       # NEW: Primary icon rail (always visible, ~48px)
  sidebar-panel.tsx           # NEW: Secondary panel container with route-based switching
  sidebar-panel-chats.tsx     # NEW: Chats panel (migrated from current sidebar content)
  sidebar-panel-sidekiqs.tsx  # NEW: Sidekiqs panel (expanded from sidebar-sidekiqs.tsx)
  sidebar-panel-teams.tsx     # NEW: Teams panel (expanded from sidebar-teams.tsx)
  sidebar-mobile-tabs.tsx     # NEW: Bottom tab bar for mobile
  sidebar-mobile-overlay.tsx  # NEW: Full-screen overlay for mobile panels
  sidebar-thread-list.tsx     # KEPT: Virtualized thread list (used inside chats panel)
  sidebar-thread-group.tsx    # KEPT: Date group headers
  sidebar-search.tsx          # KEPT: Search input (used inside panels)
  sidebar-footer.tsx          # MODIFIED: User avatar moves to icon rail bottom
  sidebar-header.tsx          # REMOVED/MERGED: Brand + New Chat moved to icon rail
  sidebar-collapsed.tsx       # REMOVED: Replaced by permanent icon rail
  sidebar-mobile.tsx          # REMOVED: Replaced by mobile tabs + overlay
  sidebar.tsx                 # REMOVED: Replaced by sidebar-layout.tsx
  index.ts                    # UPDATED: New exports
```

### Pattern 1: Flexbox Two-Tier Layout

**What:** The icon rail and secondary panel are siblings in a flex container, with the icon rail having a fixed width and the panel taking remaining sidebar width.
**When to use:** Always -- this is the core layout structure.

```typescript
// sidebar-layout.tsx
export function SidebarLayout() {
  return (
    <aside className="flex h-full">
      {/* Icon rail - always visible, fixed width */}
      <SidebarIconRail />

      {/* Separator */}
      <Separator orientation="vertical" className="border-sidebar-border" />

      {/* Secondary panel - contextual content */}
      <SidebarPanel />
    </aside>
  );
}
```

**CSS approach for the outer layout:**
```css
/* The two-tier sidebar as a flex container */
.sidebar-layout {
  display: flex;
  height: 100%;
  width: calc(48px + 288px); /* rail + panel */
}
.icon-rail {
  width: 48px;
  flex-shrink: 0;
}
.panel {
  width: 288px; /* or flex: 1 within sidebar */
  flex-shrink: 0;
}
```

In Tailwind:
```tsx
<aside className="flex h-full w-[336px]">
  <div className="w-12 shrink-0">...</div>  {/* 48px icon rail */}
  <div className="w-72 shrink-0">...</div>   {/* 288px panel */}
</aside>
```

### Pattern 2: Route-Based Panel Switching

**What:** The active panel is determined by the current URL path, not by React state.
**When to use:** This is a locked decision from CONTEXT.md.

```typescript
// sidebar-panel.tsx
"use client";

import { usePathname } from "next/navigation";

type SidebarFeature = "chats" | "sidekiqs" | "teams";

/**
 * Determines which panel to show based on the current route.
 */
function getActiveFeature(pathname: string): SidebarFeature {
  if (pathname.startsWith("/sidekiqs")) return "sidekiqs";
  if (pathname.startsWith("/settings/teams")) return "teams";
  // Default to chats for /chat, /chat/[id], and root
  return "chats";
}

export function SidebarPanel() {
  const pathname = usePathname();
  const activeFeature = getActiveFeature(pathname ?? "/chat");

  return (
    <div className="flex h-full w-72 flex-col overflow-hidden">
      {activeFeature === "chats" && <SidebarPanelChats />}
      {activeFeature === "sidekiqs" && <SidebarPanelSidekiqs />}
      {activeFeature === "teams" && <SidebarPanelTeams />}
    </div>
  );
}
```

### Pattern 3: Icon Rail with Vertical Layout

**What:** Fixed icon rail with top/middle/bottom sections using flex column with justify-between.
**When to use:** Always -- implements the locked rail layout decision.

```typescript
// sidebar-icon-rail.tsx
export function SidebarIconRail() {
  const pathname = usePathname();
  const activeFeature = getActiveFeature(pathname ?? "/chat");
  const router = useRouter();

  return (
    <div className="bg-sidebar flex h-full w-12 flex-col items-center py-3">
      {/* Top: New Chat action */}
      <Tooltip>
        <TooltipTrigger asChild>
          <Button
            variant="ghost"
            size="icon"
            onClick={() => router.push("/chat")}
            className="bg-sidebar-primary text-sidebar-primary-foreground size-8 rounded-md"
          >
            <PenSquare className="size-4" />
          </Button>
        </TooltipTrigger>
        <TooltipContent side="right">New Chat</TooltipContent>
      </Tooltip>

      {/* Middle: Navigation icons */}
      <nav className="mt-4 flex flex-col items-center gap-1">
        <RailIcon
          icon={MessageSquare}
          label="Chats"
          href="/chat"
          isActive={activeFeature === "chats"}
        />
        <RailIcon
          icon={Sparkles}
          label="Sidekiqs"
          href="/sidekiqs"
          isActive={activeFeature === "sidekiqs"}
        />
        <RailIcon
          icon={Users}
          label="Teams"
          href="/settings/teams"
          isActive={activeFeature === "teams"}
        />
      </nav>

      {/* Spacer */}
      <div className="flex-1" />

      {/* Bottom: Settings + User */}
      <div className="flex flex-col items-center gap-1">
        <RailIcon
          icon={Settings}
          label="Settings"
          href="/settings"
          isActive={pathname?.startsWith("/settings") && !pathname?.startsWith("/settings/teams")}
        />
        <UserAvatarButton />
      </div>
    </div>
  );
}
```

### Pattern 4: Mobile Bottom Tab Bar

**What:** On mobile, replace the icon rail + panel with a bottom tab bar and full-screen overlays.
**When to use:** Below md breakpoint (768px).

```typescript
// sidebar-mobile-tabs.tsx
export function SidebarMobileTabs() {
  const [activeOverlay, setActiveOverlay] = useState<SidebarFeature | null>(null);
  const pathname = usePathname();

  return (
    <>
      {/* Bottom tab bar */}
      <nav className="bg-sidebar border-sidebar-border fixed bottom-0 left-0 right-0 z-50 flex h-14 items-center justify-around border-t md:hidden">
        <TabButton
          icon={MessageSquare}
          label="Chats"
          isActive={!activeOverlay && pathname?.startsWith("/chat")}
          onClick={() => setActiveOverlay("chats")}
        />
        <TabButton
          icon={Sparkles}
          label="Sidekiqs"
          isActive={activeOverlay === "sidekiqs"}
          onClick={() => setActiveOverlay("sidekiqs")}
        />
        <TabButton
          icon={Settings}
          label="Settings"
          isActive={false}
          onClick={() => {
            setActiveOverlay(null);
            router.push("/settings");
          }}
        />
      </nav>

      {/* Full-screen overlay */}
      {activeOverlay && (
        <SidebarMobileOverlay
          feature={activeOverlay}
          onClose={() => setActiveOverlay(null)}
        />
      )}
    </>
  );
}
```

### Pattern 5: Panel Transition Animation (Claude's Discretion)

**What:** Crossfade animation when switching between panels.
**Recommendation:** Use CSS opacity + transform transitions with a short duration for snappy feel.

```typescript
// Panel content wrapper with crossfade
function PanelContent({ children, key }: { children: ReactNode; key: string }) {
  return (
    <div
      key={key}
      className="animate-in fade-in duration-150"
    >
      {children}
    </div>
  );
}
```

Alternatively, a minimal CSS approach using the existing `transition-all duration-200 ease-out`:

```css
/* In globals.css or via Tailwind */
@keyframes panel-enter {
  from {
    opacity: 0;
    transform: translateY(4px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.panel-enter {
  animation: panel-enter 150ms ease-out;
}
```

### Anti-Patterns to Avoid

- **State-based panel switching instead of route-based:** The CONTEXT.md locks panel switching to URL routes. Do NOT use React state to track which panel is active -- derive it from `usePathname()`. This ensures deep-linking works and browser back/forward navigates panels correctly.

- **Conditional rendering with `isCollapsed` for icon rail:** The old pattern uses `isCollapsed ? <SidebarCollapsed /> : <ExpandedContent />`. The new pattern has BOTH the icon rail AND panel visible simultaneously. Do not reuse the toggle pattern.

- **Adopting shadcn Sidebar component mid-project:** The shadcn Sidebar requires `SidebarProvider` wrapping the layout, `SidebarInset` for main content, cookie-based state, and specific CSS variables. Adopting it would require rewriting the chat layout, all existing sidebar state management, and mobile handling. The cost outweighs the benefit when the existing custom components work well.

- **Using Framer Motion for simple transitions:** CSS transitions and `tw-animate-css` (already installed) handle crossfade/slide panel transitions well. Adding Framer Motion (~30KB) for panel switching is overkill.

- **Duplicating state between icon rail and panel:** Both components should derive their active state from `usePathname()`. Do not pass an `activePanel` prop down -- each component reads the route independently.

## Don't Hand-Roll

| Problem | Don't Build | Use Instead | Why |
|---------|-------------|-------------|-----|
| Tooltips on icon rail | Custom tooltip component | Radix `Tooltip` (already used) | Accessibility, positioning, delay behavior handled correctly |
| Virtualized thread list | Custom virtual scroll | `@tanstack/react-virtual` (already used) | Already implemented with overscan, measurement, group headers |
| Fuzzy search | Custom search algorithm | `fuse.js` (already used) | Threshold tuning, match highlighting already implemented |
| Panel entry animations | Custom JS animation | `tw-animate-css` `animate-in` classes | Already in project, zero-JS CSS animations |
| Bottom tab bar safe area | Manual padding | `env(safe-area-inset-bottom)` in Tailwind | Handles iPhone notch/home indicator correctly |
| Route-based active detection | Custom pathname parser | `usePathname()` from `next/navigation` | SSR-safe, automatically updates on navigation |
| Responsive breakpoint detection | Custom resize observer | Tailwind `md:hidden` / `hidden md:flex` classes | CSS-only, no hydration mismatch |

**Key insight:** The existing sidebar already solves the hardest problems (virtualization, fuzzy search, thread management, keyboard shortcuts). This phase is primarily a layout restructure, not a feature build. Reuse existing components inside the new panel structure.

## Common Pitfalls

### Pitfall 1: Icon Rail Active State Misaligned with Panel Content

**What goes wrong:** The icon rail shows "Chats" as active, but the panel displays Sidekiqs content (or vice versa) because state and URL are out of sync.
**Why it happens:** If panel switching uses React state while the icon rail reads from the URL, or if `router.push()` hasn't completed when the panel renders.
**How to avoid:** Both icon rail AND panel must derive active state from `usePathname()`. No React state for panel selection. The URL is the single source of truth.
**Warning signs:** Panel content flickers or shows wrong content after clicking an icon.

### Pitfall 2: Layout Shift When Panel Content Changes

**What goes wrong:** The main content area shifts or resizes when switching between panels because different panels have different widths or the sidebar total width changes.
**Why it happens:** The sidebar width is not fixed, or the panel content causes overflow.
**How to avoid:** Fix the total sidebar width to `w-[336px]` (48px rail + 288px panel). Use `overflow-hidden` on the panel container. The main content area uses `flex-1` and is independent of sidebar content.
**Warning signs:** Main content "jumps" when clicking different navigation icons.

### Pitfall 3: Mobile Bottom Tab Bar Overlapping Content

**What goes wrong:** The bottom tab bar covers the last items in scrollable content, or the chat input is hidden behind the tab bar.
**Why it happens:** Fixed-bottom tab bar takes up space but doesn't affect document flow.
**How to avoid:** Add `pb-14` (56px) bottom padding to the mobile main content area. Use `env(safe-area-inset-bottom)` for iOS devices with home indicator. The tab bar should use `fixed bottom-0` with `z-50`.
**Warning signs:** Users cannot see or tap the last thread item, or the chat input is partially hidden.

### Pitfall 4: Breaking Existing Keyboard Shortcuts

**What goes wrong:** Cmd+B (toggle sidebar), Cmd+K (search), Cmd+Shift+S (sidekiq picker) stop working after the restructure.
**Why it happens:** The `useKeyboardShortcuts` hook is currently inside `Sidebar` component, which gets removed/replaced. If the hook is not re-mounted in the new component tree, shortcuts break.
**How to avoid:** Move `useKeyboardShortcuts` registration to `SidebarLayout` (the new top-level component). Adapt shortcuts: Cmd+B could toggle the panel (if collapsibility is supported), Cmd+K focuses search in the active panel, Cmd+Shift+S still opens sidekiq picker.
**Warning signs:** Pressing Cmd+K does nothing after the refactor.

### Pitfall 5: TanStack Virtual Scroll Position Lost on Panel Switch

**What goes wrong:** User scrolls down in the thread list, switches to Sidekiqs and back to Chats, and the scroll position resets to top.
**Why it happens:** The `SidebarPanelChats` component unmounts when switching panels, destroying the virtualizer and scroll position state.
**How to avoid:** Keep all three panels mounted but use `hidden`/`block` (display: none vs display: block) CSS classes instead of conditional rendering. This preserves scroll position and component state. Alternatively, use the existing `useScrollPosition` hook to save/restore scroll offset.
**Warning signs:** User loses their place in the thread list after panel switching.

### Pitfall 6: Hydration Mismatch on Mobile vs Desktop

**What goes wrong:** Server renders the desktop layout, but the client detects mobile and shows the bottom tab bar, causing a hydration mismatch.
**Why it happens:** `window.innerWidth` is not available during SSR. Using a JavaScript-based mobile detection in initial render causes mismatch.
**How to avoid:** Use CSS-only responsive classes (`md:hidden` and `hidden md:flex`) for desktop vs mobile layout switching. Never use JS-based breakpoint detection for initial render. Both layouts can be rendered and hidden via CSS.
**Warning signs:** Console warnings about hydration mismatch, layout flickers on page load.

### Pitfall 7: Settings Route Active State Conflict with Teams

**What goes wrong:** The Settings icon and Teams icon both highlight when on `/settings/teams` because both routes start with `/settings`.
**Why it happens:** Naive `pathname.startsWith("/settings")` check matches both Settings and Teams.
**How to avoid:** Check Teams first: if `pathname.startsWith("/settings/teams")` it's Teams. Settings is only active for `/settings` paths that are NOT `/settings/teams`. Use specific ordering in the `getActiveFeature()` function.
**Warning signs:** Two icons highlighted simultaneously in the rail.

## Code Examples

### Icon Rail Item Component

```typescript
// Reusable rail icon button with active state indicator
// Source: custom, based on existing sidebar-collapsed.tsx patterns

interface RailIconProps {
  icon: LucideIcon;
  label: string;
  href: string;
  isActive: boolean;
}

function RailIcon({ icon: Icon, label, href, isActive }: RailIconProps) {
  return (
    <Tooltip>
      <TooltipTrigger asChild>
        <Button
          variant="ghost"
          size="icon"
          asChild
          className={cn(
            "size-9 rounded-md",
            "text-sidebar-foreground/70 hover:text-sidebar-foreground",
            isActive && "bg-sidebar-accent text-sidebar-foreground border-sidebar-primary border-l-2"
          )}
        >
          <Link href={href}>
            <Icon className="size-5" />
          </Link>
        </Button>
      </TooltipTrigger>
      <TooltipContent side="right">{label}</TooltipContent>
    </Tooltip>
  );
}
```

### Route-to-Feature Mapping

```typescript
// Centralized route-to-feature mapping (used by both icon rail and panel)
// Source: custom, based on CONTEXT.md decisions

type SidebarFeature = "chats" | "sidekiqs" | "teams";

/**
 * Determines the active sidebar feature from the current URL pathname.
 * Settings navigates to full page -- no sidebar feature for it.
 *
 * @param pathname - Current URL pathname from usePathname()
 * @returns The active sidebar feature
 */
function getActiveFeature(pathname: string): SidebarFeature {
  // Teams check must come before general /settings check
  if (pathname.startsWith("/settings/teams")) return "teams";
  if (pathname.startsWith("/sidekiqs")) return "sidekiqs";
  // Default: /chat, /chat/[id], /, and anything else
  return "chats";
}
```

### Chat Layout Integration

```typescript
// Updated chat/layout.tsx with two-tier sidebar
// Source: based on existing layout.tsx pattern

export default function ChatLayout({ children }: { children: React.ReactNode }) {
  return (
    <TooltipProvider>
      <div className="flex h-screen">
        {/* Desktop: Two-tier sidebar (icon rail + panel) */}
        <div className="hidden md:flex">
          <SidebarLayout />
        </div>

        {/* Main content area */}
        <div className="flex flex-1 flex-col">
          {/* Mobile: bottom padding for tab bar */}
          <main className="flex-1 overflow-hidden pb-14 md:pb-0">
            {children}
          </main>
        </div>

        {/* Mobile: Bottom tab bar */}
        <SidebarMobileTabs />
      </div>
    </TooltipProvider>
  );
}
```

### Panel Content Preservation (Hidden vs Unmount)

```typescript
// Keep panels mounted but visually hidden to preserve scroll position
// Source: standard React pattern for tab-like interfaces

export function SidebarPanel() {
  const pathname = usePathname();
  const activeFeature = getActiveFeature(pathname ?? "/chat");

  return (
    <div className="flex h-full w-72 flex-col overflow-hidden">
      {/* All panels stay mounted -- only display changes */}
      <div className={cn("flex h-full flex-col", activeFeature !== "chats" && "hidden")}>
        <SidebarPanelChats />
      </div>
      <div className={cn("flex h-full flex-col", activeFeature !== "sidekiqs" && "hidden")}>
        <SidebarPanelSidekiqs />
      </div>
      <div className={cn("flex h-full flex-col", activeFeature !== "teams" && "hidden")}>
        <SidebarPanelTeams />
      </div>
    </div>
  );
}
```

### Mobile Full-Screen Overlay

```typescript
// Full-screen overlay for mobile panels (replaces current Sheet drawer)
// Source: based on existing sidebar-mobile.tsx pattern

export function SidebarMobileOverlay({
  feature,
  onClose,
}: {
  feature: SidebarFeature;
  onClose: () => void;
}) {
  return (
    <div className="bg-sidebar animate-in slide-in-from-bottom fixed inset-0 z-50 flex flex-col duration-200 md:hidden">
      {/* Header with close button */}
      <div className="border-sidebar-border flex h-14 items-center justify-between border-b px-4">
        <h2 className="text-sidebar-foreground text-sm font-semibold capitalize">
          {feature}
        </h2>
        <Button variant="ghost" size="icon" onClick={onClose}>
          <X className="size-5" />
        </Button>
      </div>

      {/* Panel content */}
      <div className="flex-1 overflow-hidden">
        {feature === "chats" && <SidebarPanelChats />}
        {feature === "sidekiqs" && <SidebarPanelSidekiqs />}
        {feature === "teams" && <SidebarPanelTeams />}
      </div>
    </div>
  );
}
```

## State of the Art

| Old Approach | Current Approach | When Changed | Impact |
|--------------|------------------|--------------|--------|
| Hamburger menu for mobile sidebar | Bottom tab bar (iOS/Android native pattern) | 2023+ | Better thumb reachability, matches native app conventions |
| State-based sidebar panels | Route-based panel switching | Architecture trend | Deep-linking works, browser history preserves panel state |
| Full sidebar collapse to icon rail | Always-visible icon rail alongside panel | Discord/Linear pattern | Icon rail serves as persistent landmark for navigation |
| Sheet/drawer for mobile sidebar | Full-screen overlay panels | t3.chat, Linear mobile | More content space, cleaner navigation on small screens |
| Framer Motion for sidebar animations | CSS transitions + tw-animate-css | Performance trend | Smaller bundle, GPU-accelerated CSS animations |

**Deprecated/outdated:**
- `sidebar-collapsed.tsx`: The old collapsed icon rail view will be removed -- replaced by the permanent icon rail
- `sidebar-mobile.tsx`: The Sheet-based mobile drawer will be removed -- replaced by bottom tab bar + overlay
- `useSidebarState` hook (collapse toggle): The sidebar no longer collapses -- the icon rail is always visible. This hook may be repurposed for panel collapsibility (Claude's discretion) or removed entirely
- `sidebar.tsx`: The monolithic sidebar component will be replaced by `sidebar-layout.tsx` as the top-level composition

## Open Questions

1. **Panel collapsibility (Claude's discretion)**
   - What we know: The icon rail is always visible. The secondary panel could optionally be collapsed to show only the icon rail.
   - What's unclear: Whether users need to collapse the panel for more main content space, or if the fixed width is always acceptable.
   - Recommendation: Support panel collapse via Cmd+B (reusing existing shortcut). When collapsed, only the 48px icon rail is visible. This preserves the existing UX expectation. Store state in localStorage with key `sidebar-panel-collapsed`.

2. **Toggle-on-re-click behavior (Claude's discretion)**
   - What we know: Clicking an already-active icon could: (a) do nothing, (b) collapse/expand the panel, (c) scroll the panel to top.
   - What's unclear: Which behavior feels most natural.
   - Recommendation: Re-clicking the active icon collapses/expands the panel. This matches VS Code behavior and gives a natural toggle mechanism.

3. **Session persistence for last active panel (Claude's discretion)**
   - What we know: Route-based switching means the active panel is determined by the URL.
   - What's unclear: Whether navigating to `/chat` after being on `/sidekiqs` should remember the sidekiqs panel or switch to chats.
   - Recommendation: No session persistence needed -- the URL IS the persistence mechanism. When user navigates to `/chat`, the chats panel shows. This is the simplest and most predictable behavior.

4. **Panel header design (Claude's discretion)**
   - What we know: Each panel needs some header area.
   - What's unclear: Whether headers should have titles, action buttons, or be minimal.
   - Recommendation: Titled headers with contextual actions. "Chats" header with team filter dropdown. "Sidekiqs" header with create button. "Teams" header with create button. Use `text-xs font-medium` matching existing section header pattern.

5. **Panel transition animation style (Claude's discretion)**
   - What we know: Some animation is expected between panel switches.
   - What's unclear: Whether crossfade, slide, or instant swap is best.
   - Recommendation: Instant content swap with subtle fade-in (`animate-in fade-in duration-150`). Crossfade between panels requires both to be visible simultaneously which complicates layout. Instant swap with fade-in feels snappy and is easiest to implement with `tw-animate-css`.

6. **Mobile breakpoint (Claude's discretion)**
   - What we know: Tailwind `md:` breakpoint (768px) is currently used for mobile/desktop split.
   - What's unclear: Whether 768px is the right breakpoint for bottom tab bar transition.
   - Recommendation: Keep `md:` (768px) breakpoint for consistency with existing responsive behavior.

7. **Sidebar layout scope**
   - What we know: Currently the sidebar lives in `chat/layout.tsx`. The two-tier sidebar should be visible on ALL dashboard pages (chat, sidekiqs, settings).
   - What's unclear: Whether to move the sidebar to the dashboard layout or keep separate layouts.
   - Recommendation: Move `SidebarLayout` to `(dashboard)/layout.tsx` since it needs to be visible across all routes. This is a significant but necessary layout change.

## Sources

### Primary (HIGH confidence)
- **Codebase analysis** - Read all 11 sidebar component files, layout files, hooks, and package.json directly
- **CONTEXT.md** (`.planning/phases/8.2-two-tier-sidebar-navigation/8.2-CONTEXT.md`) - Locked decisions for icon rail design, panel transitions, feature mapping, and mobile behavior
- **Phase 8.1 summaries** - Sidebar semantic token patterns, active state indicators, branding decisions
- [shadcn/ui Sidebar docs](https://ui.shadcn.com/docs/components/sidebar) - SidebarRail, collapsible="icon", dual sidebar patterns, SidebarProvider API
- [shadcn/ui Sidebar blocks](https://ui.shadcn.com/blocks/sidebar) - Sidebar-07 (collapses to icons), Sidebar-08 (inset with secondary navigation)

### Secondary (MEDIUM confidence)
- [How we redesigned the Linear UI](https://linear.app/now/how-we-redesigned-the-linear-ui) - Linear's sidebar architecture and design philosophy
- [VS Code UX Guidelines - Sidebars](https://code.visualstudio.com/api/ux-guidelines/sidebars) - Activity Bar + Primary Sidebar two-tier pattern
- [Motion docs - Layout animations](https://motion.dev/docs/react-layout-animations) - AnimatePresence patterns (decided against using)
- [Tailwind CSS transition docs](https://tailwindcss.com/docs/transition-property) - CSS-only transition approach
- [uinkits - Navigation Rail](https://www.uinkits.com/blog-post/what-is-a-navigation-rail-and-how-to-use-it-in-ui-ux-design) - Navigation rail UX pattern definition

### Tertiary (LOW confidence)
- [Architecting a Scalable Sidebar System (Medium)](https://medium.com/@rivainasution/shadcn-ui-react-series-part-11-sidebar-architecting-a-scalable-sidebar-system-in-react-f45274043863) - Community approach to shadcn sidebar architecture

## Metadata

**Confidence breakdown:**
- Standard stack: HIGH - All libraries already in project, no new dependencies
- Architecture: HIGH - Pattern is well-understood (Discord/VS Code/Linear model), codebase thoroughly analyzed
- Pitfalls: HIGH - Based on direct codebase analysis of existing patterns that need migration
- Mobile pattern: MEDIUM - Bottom tab bar is standard but full-screen overlay specifics are custom
- Transition animations: MEDIUM - CSS approach is standard but specific `tw-animate-css` class availability not fully verified

**Research date:** 2026-01-26
**Valid until:** 2026-02-25 (30 days -- stable patterns, no fast-moving dependencies)
