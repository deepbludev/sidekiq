---
phase: 08.2-two-tier-sidebar-navigation-architecture
plan: 04
type: execute
wave: 2
depends_on: ["08.2-01"]
files_modified:
  - sidekiq-webapp/src/components/sidebar/sidebar-mobile-tabs.tsx
  - sidekiq-webapp/src/components/sidebar/sidebar-mobile-overlay.tsx
  - sidekiq-webapp/src/app/(dashboard)/layout.tsx
autonomous: true

must_haves:
  truths:
    - "Mobile bottom tab bar shows Chats, Sidekiqs, Settings tabs below md breakpoint"
    - "Tapping a tab opens full-screen overlay with that panel's content"
    - "Settings tab navigates to /settings without overlay"
    - "Bottom tab bar is hidden on desktop (md:hidden)"
    - "Overlay has close button and slides in from bottom"
  artifacts:
    - path: "sidekiq-webapp/src/components/sidebar/sidebar-mobile-tabs.tsx"
      provides: "Fixed bottom tab bar for mobile navigation"
      exports: ["SidebarMobileTabs"]
    - path: "sidekiq-webapp/src/components/sidebar/sidebar-mobile-overlay.tsx"
      provides: "Full-screen overlay for mobile panel content"
      exports: ["SidebarMobileOverlay"]
  key_links:
    - from: "sidebar-mobile-tabs.tsx"
      to: "sidebar-mobile-overlay.tsx"
      via: "renders overlay when tab is tapped"
      pattern: "SidebarMobileOverlay"
    - from: "sidebar-mobile-overlay.tsx"
      to: "sidebar-panel-chats.tsx + sidebar-panel-sidekiqs.tsx"
      via: "renders panel content inside overlay"
      pattern: "SidebarPanelChats|SidebarPanelSidekiqs"
    - from: "(dashboard)/layout.tsx"
      to: "sidebar-mobile-tabs.tsx"
      via: "renders bottom tab bar for mobile"
      pattern: "SidebarMobileTabs"
---

<objective>
Create the mobile navigation experience: a bottom tab bar replacing the current hamburger menu, plus full-screen overlays for panel content.

Purpose: Mobile users need a native-feeling navigation pattern. The bottom tab bar follows iOS/Android conventions for thumb reachability. Full-screen overlays provide more content space than the current Sheet drawer.

Output: Bottom tab bar component, full-screen overlay component, and dashboard layout integration.
</objective>

<execution_context>
@/Users/carlocasorzo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/carlocasorzo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08.2-two-tier-sidebar-navigation-architecture/08.2-RESEARCH.md
@.planning/phases/8.2-two-tier-sidebar-navigation/8.2-CONTEXT.md
@.planning/phases/08.2-two-tier-sidebar-navigation-architecture/08.2-01-SUMMARY.md

# Current mobile component (to be replaced)
@sidekiq-webapp/src/components/sidebar/sidebar-mobile.tsx
@sidekiq-webapp/src/app/(dashboard)/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create mobile bottom tab bar and full-screen overlay</name>
  <files>
    sidekiq-webapp/src/components/sidebar/sidebar-mobile-tabs.tsx
    sidekiq-webapp/src/components/sidebar/sidebar-mobile-overlay.tsx
  </files>
  <action>
    **1. Create `sidebar-mobile-overlay.tsx`:**

    "use client" component. Full-screen overlay that renders panel content for mobile.

    Props:
    ```tsx
    interface SidebarMobileOverlayProps {
      feature: "chats" | "sidekiqs";  // No "teams" -- teams go to settings page
      onClose: () => void;
    }
    ```

    Structure:
    - Wrapper: `fixed inset-0 z-50 flex flex-col bg-sidebar animate-in slide-in-from-bottom duration-200 md:hidden`
    - Header row: `flex h-14 items-center justify-between border-b border-sidebar-border px-4`
      - Title: `text-sm font-semibold text-sidebar-foreground capitalize` showing the feature name
      - Close button: Button with X icon, onClick calls `onClose`
    - Content: `flex-1 overflow-hidden`
      - Conditionally render:
        - `feature === "chats"` -> `<SidebarPanelChats />`
        - `feature === "sidekiqs"` -> `<SidebarPanelSidekiqs />`

    Import SidebarPanelChats and SidebarPanelSidekiqs. Include a "New Chat" button in the chats overlay header (PenSquare icon) that navigates to /chat and closes the overlay.

    **2. Create `sidebar-mobile-tabs.tsx`:**

    "use client" component. Fixed bottom tab bar visible only on mobile.

    Local state: `const [activeOverlay, setActiveOverlay] = useState<"chats" | "sidekiqs" | null>(null);`

    Use `usePathname()` for active tab highlighting and `useRouter()` for Settings navigation.

    Structure:
    - Tab bar: `fixed bottom-0 left-0 right-0 z-50 flex h-14 items-center justify-around border-t border-sidebar-border bg-sidebar md:hidden`
    - Add `pb-[env(safe-area-inset-bottom)]` for iOS home indicator.
    - Three tabs:
      - **Chats:** icon=MessageSquare, label="Chats", onClick opens chats overlay, isActive when pathname starts with /chat and no overlay open
      - **Sidekiqs:** icon=Sparkles, label="Sidekiqs", onClick opens sidekiqs overlay, isActive when overlay === "sidekiqs"
      - **Settings:** icon=Settings, label="Settings", onClick navigates to /settings (router.push), isActive when pathname starts with /settings

    Internal `TabButton` sub-component:
    ```tsx
    interface TabButtonProps {
      icon: LucideIcon;
      label: string;
      isActive: boolean;
      onClick: () => void;
    }
    ```
    - Render: `button` with `flex flex-col items-center gap-0.5 py-1 px-3`
    - Icon: `size-5`
    - Label: `text-[10px] font-medium`
    - Active: `text-sidebar-primary`, Inactive: `text-sidebar-foreground/70`

    Render the `SidebarMobileOverlay` when activeOverlay is not null. When overlay closes, set activeOverlay to null. When navigating away (clicking a thread in the overlay), close the overlay via the onClose callback.

    When overlay is open, render a `SidebarMobileOverlay` with the active feature and onClose handler. The overlay should close when the user:
    - Clicks the X button
    - Clicks a thread/sidekiq item (which navigates and the overlay should auto-close)

    For auto-close on navigation: Use a useEffect that watches pathname changes and closes the overlay when pathname changes:
    ```tsx
    useEffect(() => {
      setActiveOverlay(null);
    }, [pathname]);
    ```
  </action>
  <verify>
    Run `npx tsc --noEmit` from sidekiq-webapp/ -- no type errors.
    Verify mobile tab bar renders with md:hidden (only visible below 768px).
    Verify overlay has animate-in slide-in-from-bottom animation class.
  </verify>
  <done>
    SidebarMobileTabs renders fixed bottom tab bar with 3 tabs (Chats, Sidekiqs, Settings). SidebarMobileOverlay renders full-screen panel content with slide-up animation. Overlay auto-closes on navigation. Settings tab navigates directly without overlay.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate mobile components into dashboard layout</name>
  <files>
    sidekiq-webapp/src/app/(dashboard)/layout.tsx
  </files>
  <action>
    Update the dashboard layout (which was modified in Plan 03) to include the mobile tab bar:

    ```tsx
    import { SidebarLayout } from "@sidekiq/components/sidebar/sidebar-layout";
    import { SidebarMobileTabs } from "@sidekiq/components/sidebar/sidebar-mobile-tabs";

    export default async function DashboardLayout({
      children,
    }: {
      children: React.ReactNode;
    }) {
      const session = await getSession();
      if (!session) {
        redirect("/sign-in");
      }

      return (
        <TooltipProvider>
          <div className="bg-background flex h-screen">
            {/* Desktop: Two-tier sidebar */}
            <div className="hidden md:flex">
              <SidebarLayout />
            </div>

            {/* Main content area */}
            <main className="flex-1 overflow-hidden pb-14 md:pb-0">
              {children}
            </main>

            {/* Mobile: Bottom tab bar */}
            <SidebarMobileTabs />
          </div>
        </TooltipProvider>
      );
    }
    ```

    Key changes:
    - Add `pb-14 md:pb-0` to main content to prevent bottom tab bar from overlapping content on mobile. `pb-14` = 56px = h-14 tab bar height.
    - Render `<SidebarMobileTabs />` as sibling to main content. It uses `fixed bottom-0` positioning with `md:hidden`.
    - The SidebarMobileTabs component handles its own overlay rendering internally.

    NOTE: This layout change depends on Plan 03 having already modified the dashboard layout. If executing in parallel with Plan 03, the executor should merge both changes. The important thing is that both SidebarLayout (desktop) and SidebarMobileTabs (mobile) end up in the dashboard layout.
  </action>
  <verify>
    Run `npx tsc --noEmit` from sidekiq-webapp/.
    Run `npm run build` from sidekiq-webapp/ to verify no SSR issues.
    Check that mobile bottom padding is applied: `grep "pb-14" sidekiq-webapp/src/app/\(dashboard\)/layout.tsx`
  </verify>
  <done>
    Dashboard layout renders both desktop sidebar (hidden on mobile) and mobile tab bar (hidden on desktop). Main content has bottom padding on mobile to avoid tab bar overlap. Mobile users see bottom tab bar with Chats/Sidekiqs/Settings.
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- `npm run build` succeeds
- Below 768px: bottom tab bar visible, desktop sidebar hidden
- Above 768px: desktop sidebar visible, bottom tab bar hidden
- Tapping Chats tab opens full-screen overlay with thread list
- Tapping Sidekiqs tab opens full-screen overlay with sidekiq list
- Tapping Settings tab navigates to /settings (no overlay)
- Overlay closes when X is clicked or when navigation occurs
- Main content has pb-14 bottom padding on mobile
</verification>

<success_criteria>
- Mobile bottom tab bar replaces hamburger menu pattern
- Full-screen overlay replaces Sheet drawer
- Overlay auto-closes on route changes
- iOS safe area handled with env(safe-area-inset-bottom)
- No layout overlap between tab bar and main content
- CSS-only responsive switching (no JS breakpoint detection)
</success_criteria>

<output>
After completion, create `.planning/phases/08.2-two-tier-sidebar-navigation-architecture/08.2-04-SUMMARY.md`
</output>
