---
phase: 08.2-two-tier-sidebar-navigation-architecture
plan: 01
subsystem: ui
tags: [sidebar, icon-rail, navigation, flexbox, route-based-switching, radix-tooltip, lucide]

# Dependency graph
requires:
  - phase: 08.1-rethink-branding-ui
    provides: Semantic sidebar tokens (sidebar-primary, sidebar-accent, sidebar-foreground/70)
provides:
  - SidebarFeature type and getActiveFeature() route-to-panel mapping utility
  - SidebarIconRail component with New Chat, nav icons, Settings, user avatar dropdown
  - SidebarPanel container with hidden/block panel switching for state preservation
  - SidebarLayout two-tier composition (rail + separator + panel at 336px)
affects: [08.2-02 panel content, 08.2-03 mobile, 08.2-04 layout integration, 08.2-05 cleanup]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Route-based panel switching via getActiveFeature(pathname)"
    - "Hidden/block CSS pattern for panel preservation (no conditional unmount)"
    - "Two-tier sidebar flexbox composition (48px rail + 288px panel = 336px)"
    - "RailIcon sub-component with Tooltip + Button asChild + Link for nav items"

key-files:
  created:
    - sidekiq-webapp/src/lib/sidebar-utils.ts
    - sidekiq-webapp/src/components/sidebar/sidebar-icon-rail.tsx
    - sidekiq-webapp/src/components/sidebar/sidebar-panel.tsx
    - sidekiq-webapp/src/components/sidebar/sidebar-layout.tsx
  modified: []

key-decisions:
  - "getActiveFeature checks /settings/teams before /settings to avoid double-highlighting"
  - "Panel uses hidden class (display:none) instead of conditional rendering to preserve scroll position"
  - "UserAvatarButton dropdown opens side=right from the rail for natural positioning"
  - "Settings icon active when pathname starts with /settings AND activeFeature is not teams"

patterns-established:
  - "Route-to-feature mapping: both icon rail and panel derive active state from usePathname() independently"
  - "RailIcon pattern: Tooltip > Button(ghost, icon, asChild) > Link for accessible nav"
  - "Sidebar layout: aside with fixed width, flex children with shrink-0"

# Metrics
duration: 2min
completed: 2026-01-26
---

# Phase 8.2 Plan 01: Core Sidebar Structure Summary

**Two-tier sidebar layout with 48px icon rail, route-based panel switching via getActiveFeature(), and 336px flexbox composition**

## Performance

- **Duration:** 2 min
- **Started:** 2026-01-26T17:56:39Z
- **Completed:** 2026-01-26T17:59:03Z
- **Tasks:** 2
- **Files created:** 4

## Accomplishments
- Created centralized route-to-feature mapping utility (sidebar-utils.ts) used by both rail and panel
- Built icon rail with New Chat action, 3 navigation icons, Settings, and user avatar dropdown with theme submenu
- Established hidden/block panel switching pattern that preserves component state across panel switches
- Composed SidebarLayout as a fixed-width flex container with icon rail + separator + panel

## Task Commits

Each task was committed atomically:

1. **Task 1: Create route-to-feature utility and icon rail component** - `096c0d6` (feat)
2. **Task 2: Create panel container and sidebar layout composition** - `c84413e` (feat)

## Files Created/Modified
- `sidekiq-webapp/src/lib/sidebar-utils.ts` - SidebarFeature type and getActiveFeature() pure function for route-to-panel mapping
- `sidekiq-webapp/src/components/sidebar/sidebar-icon-rail.tsx` - Primary icon rail with RailIcon sub-component and UserAvatarButton
- `sidekiq-webapp/src/components/sidebar/sidebar-panel.tsx` - Secondary panel container with hidden/block switching (placeholder content)
- `sidekiq-webapp/src/components/sidebar/sidebar-layout.tsx` - Two-tier sidebar composition (rail + separator + panel)

## Decisions Made
- getActiveFeature checks /settings/teams before general /settings to avoid both Settings and Teams icons highlighting simultaneously (addresses Pitfall 7 from research)
- Panel uses CSS `hidden` class (display:none) instead of conditional rendering to preserve TanStack Virtual scroll position and component state (addresses Pitfall 5 from research)
- UserAvatarButton dropdown opens `side="right"` from the rail for natural spatial positioning
- Settings icon uses compound active check: `pathname?.startsWith("/settings") && activeFeature !== "teams"` to avoid conflict with Teams route

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness
- SidebarLayout is ready for integration into the dashboard layout (Plan 04)
- SidebarPanel has placeholder content ready to be replaced with real panel components (Plan 02)
- SidebarIconRail is fully functional with all navigation icons and user avatar dropdown
- All four new files compile cleanly with zero type errors

---
*Phase: 08.2-two-tier-sidebar-navigation-architecture*
*Completed: 2026-01-26*
