---
phase: 08.2-two-tier-sidebar-navigation-architecture
plan: 05
type: execute
wave: 3
depends_on: ["08.2-03", "08.2-04"]
files_modified:
  - sidekiq-webapp/src/components/sidebar/sidebar.tsx
  - sidekiq-webapp/src/components/sidebar/sidebar-collapsed.tsx
  - sidekiq-webapp/src/components/sidebar/sidebar-mobile.tsx
  - sidekiq-webapp/src/components/sidebar/sidebar-header.tsx
  - sidekiq-webapp/src/components/sidebar/sidebar-footer.tsx
  - sidekiq-webapp/src/components/sidebar/index.ts
  - sidekiq-webapp/src/hooks/use-sidebar-state.ts
autonomous: false

must_haves:
  truths:
    - "Old sidebar files (sidebar.tsx, sidebar-collapsed.tsx, sidebar-mobile.tsx, sidebar-header.tsx) are deleted"
    - "sidebar-footer.tsx is deleted (user avatar moved to icon rail)"
    - "No imports reference the deleted components anywhere in the codebase"
    - "Barrel export (index.ts) exports new components: SidebarLayout, SidebarMobileTabs"
    - "Application builds and runs without errors after cleanup"
    - "Two-tier sidebar looks correct visually in both light and dark mode"
  artifacts:
    - path: "sidekiq-webapp/src/components/sidebar/index.ts"
      provides: "Updated barrel exports for new sidebar architecture"
      contains: "SidebarLayout"
  key_links:
    - from: "index.ts"
      to: "sidebar-layout.tsx"
      via: "barrel export"
      pattern: "export.*SidebarLayout"
    - from: "(dashboard)/layout.tsx"
      to: "sidebar-layout.tsx"
      via: "import SidebarLayout"
      pattern: "SidebarLayout"
---

<objective>
Remove old sidebar components, update barrel exports, fix any remaining import references, and visually verify the complete two-tier sidebar.

Purpose: Clean up the old single-panel sidebar architecture that has been replaced by the two-tier layout. This prevents dead code and ensures no stale imports cause build failures.

Output: Clean codebase with only the new two-tier sidebar components, updated exports, and visual verification.
</objective>

<execution_context>
@/Users/carlocasorzo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/carlocasorzo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08.2-two-tier-sidebar-navigation-architecture/08.2-RESEARCH.md
@.planning/phases/08.2-two-tier-sidebar-navigation-architecture/08.2-03-SUMMARY.md
@.planning/phases/08.2-two-tier-sidebar-navigation-architecture/08.2-04-SUMMARY.md

# Files to be removed/updated
@sidekiq-webapp/src/components/sidebar/index.ts
@sidekiq-webapp/src/components/sidebar/sidebar.tsx
@sidekiq-webapp/src/components/sidebar/sidebar-collapsed.tsx
@sidekiq-webapp/src/components/sidebar/sidebar-mobile.tsx
@sidekiq-webapp/src/components/sidebar/sidebar-header.tsx
@sidekiq-webapp/src/components/sidebar/sidebar-footer.tsx
@sidekiq-webapp/src/hooks/use-sidebar-state.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Delete old components, update exports, fix imports</name>
  <files>
    sidekiq-webapp/src/components/sidebar/sidebar.tsx
    sidekiq-webapp/src/components/sidebar/sidebar-collapsed.tsx
    sidekiq-webapp/src/components/sidebar/sidebar-mobile.tsx
    sidekiq-webapp/src/components/sidebar/sidebar-header.tsx
    sidekiq-webapp/src/components/sidebar/sidebar-footer.tsx
    sidekiq-webapp/src/components/sidebar/index.ts
    sidekiq-webapp/src/hooks/use-sidebar-state.ts
  </files>
  <action>
    **1. Delete the following files:**
    - `sidekiq-webapp/src/components/sidebar/sidebar.tsx` -- replaced by sidebar-layout.tsx
    - `sidekiq-webapp/src/components/sidebar/sidebar-collapsed.tsx` -- replaced by permanent icon rail
    - `sidekiq-webapp/src/components/sidebar/sidebar-mobile.tsx` -- replaced by mobile tabs + overlay
    - `sidekiq-webapp/src/components/sidebar/sidebar-header.tsx` -- brand + new chat moved to icon rail, team dropdown moved to chats panel
    - `sidekiq-webapp/src/components/sidebar/sidebar-footer.tsx` -- user avatar moved to icon rail bottom

    **2. Evaluate `use-sidebar-state.ts`:**
    The old `useSidebarState` hook managed the collapsed/expanded toggle. The new architecture uses panel collapsibility managed inside `sidebar-layout.tsx` with its own localStorage key (`sidebar-panel-collapsed`). If `use-sidebar-state.ts` is no longer imported anywhere after the refactor, delete it. If it's still referenced (e.g., in tests), update or delete the references.

    **3. Update `index.ts` barrel exports:**
    ```tsx
    /**
     * Sidebar components barrel export.
     *
     * @module sidebar
     */
    export { SidebarLayout } from "./sidebar-layout";
    export { SidebarIconRail } from "./sidebar-icon-rail";
    export { SidebarPanel } from "./sidebar-panel";
    export { SidebarPanelChats } from "./sidebar-panel-chats";
    export { SidebarPanelSidekiqs } from "./sidebar-panel-sidekiqs";
    export { SidebarPanelTeams } from "./sidebar-panel-teams";
    export { SidebarMobileTabs } from "./sidebar-mobile-tabs";
    export { SidebarMobileOverlay } from "./sidebar-mobile-overlay";
    export { SidebarSearch } from "./sidebar-search";
    export { SidebarThreadList } from "./sidebar-thread-list";
    export { SidebarThreadGroup } from "./sidebar-thread-group";
    ```

    **4. Search and fix ALL remaining imports of deleted components:**

    Run `grep -r "sidebar-collapsed\|sidebar-mobile\|sidebar-header\|sidebar-footer\|SidebarCollapsed\|SidebarMobile\|SidebarHeader\|SidebarFooter\|useSidebarState" sidekiq-webapp/src/` to find any remaining references.

    Expected locations to fix:
    - `chat/layout.tsx` -- already updated in Plan 03 to remove Sidebar/SidebarMobile imports. Verify.
    - Any test files in `tests/` that reference old components -- update or delete.

    Also search for old `Sidebar` import (the component, not the module):
    `grep -r "from.*sidebar.*import.*{ Sidebar" sidekiq-webapp/src/`
    Any remaining `{ Sidebar }` imports should be changed to `{ SidebarLayout }`.

    **5. Verify build:**
    Run `npx tsc --noEmit` and `npm run build` from sidekiq-webapp/ to confirm zero errors after cleanup.

    **6. Clean up the old `sidebar-collapsed` localStorage key:**
    The old key was `"sidebar-collapsed"`. The new key is `"sidebar-panel-collapsed"`. This is fine -- the old key will simply be ignored. No migration needed.
  </action>
  <verify>
    Run `npx tsc --noEmit` from sidekiq-webapp/ -- zero errors.
    Run `npm run build` from sidekiq-webapp/ -- build succeeds.
    Run `grep -r "SidebarCollapsed\|SidebarMobile\b\|SidebarHeader\|SidebarFooter\|useSidebarState" sidekiq-webapp/src/` -- zero results (no stale imports).
    Confirm deleted files no longer exist: `ls sidekiq-webapp/src/components/sidebar/sidebar.tsx 2>/dev/null` returns error.
  </verify>
  <done>
    Five old sidebar files deleted (sidebar.tsx, sidebar-collapsed.tsx, sidebar-mobile.tsx, sidebar-header.tsx, sidebar-footer.tsx). use-sidebar-state.ts deleted if no longer referenced. Barrel exports updated to new component set. All imports fixed. Build passes cleanly.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete two-tier sidebar navigation architecture:
    - Desktop: Permanent 48px icon rail with New Chat, Chats, Sidekiqs, Teams, Settings, User avatar
    - Desktop: 288px contextual secondary panel that switches based on URL
    - Desktop: Panel collapse via Cmd+B or re-clicking active icon
    - Mobile: Bottom tab bar with Chats, Sidekiqs, Settings
    - Mobile: Full-screen overlay panels with slide-up animation
    - Keyboard shortcuts: Cmd+B (toggle panel), Cmd+K (search), Cmd+N (new chat), Cmd+Shift+S (sidekiq picker)
  </what-built>
  <how-to-verify>
    1. Run `npm run dev` from sidekiq-webapp/
    2. Open http://localhost:3000/chat in browser

    **Desktop verification (above 768px):**
    3. Verify icon rail on left with: PenSquare (top), MessageSquare/Sparkles/Users (middle), Settings/Avatar (bottom)
    4. Verify Chats panel shows to the right of icon rail with search + thread list
    5. Click Sidekiqs icon in rail -- verify panel switches to Sidekiqs list
    6. Click Teams icon -- verify panel switches to Teams list
    7. Click Settings icon -- verify it navigates to /settings page
    8. Press Cmd+B -- verify panel collapses, leaving only icon rail
    9. Press Cmd+B again -- verify panel expands back
    10. Press Cmd+K -- verify search input focuses in Chats panel
    11. Click user avatar at bottom of rail -- verify dropdown with Settings/Theme/Logout
    12. Toggle between dark and light mode -- verify sidebar looks correct in both

    **Mobile verification (resize to below 768px or use DevTools):**
    13. Verify bottom tab bar with Chats/Sidekiqs/Settings tabs
    14. Tap Chats tab -- verify full-screen overlay with thread list
    15. Tap X to close overlay
    16. Tap Sidekiqs tab -- verify full-screen overlay with sidekiq list
    17. Tap Settings tab -- verify navigation to /settings (no overlay)
    18. Verify no content is hidden behind the tab bar (pb-14 bottom padding)

    **Panel switching verification:**
    19. Navigate to /sidekiqs -- verify Sidekiqs icon is highlighted in rail and Sidekiqs panel shows
    20. Navigate to /settings/teams -- verify Teams icon is highlighted (not Settings)
    21. Navigate to /chat -- verify Chats icon is highlighted and Chats panel shows
  </how-to-verify>
  <resume-signal>Type "approved" if sidebar looks and works correctly, or describe any issues.</resume-signal>
</task>

</tasks>

<verification>
- No deleted component references exist in codebase
- Build passes with zero errors
- All routes show correct sidebar state
- Visual verification confirms two-tier sidebar works in both themes
</verification>

<success_criteria>
- Old sidebar files are deleted, no dead code remains
- Barrel exports reflect new architecture
- Application builds and runs without errors
- Human verifies: desktop two-tier sidebar with panel switching, collapsibility
- Human verifies: mobile bottom tab bar with overlays
- Human verifies: keyboard shortcuts work correctly
- Human verifies: dark and light mode rendering
</success_criteria>

<output>
After completion, create `.planning/phases/08.2-two-tier-sidebar-navigation-architecture/08.2-05-SUMMARY.md`
</output>
