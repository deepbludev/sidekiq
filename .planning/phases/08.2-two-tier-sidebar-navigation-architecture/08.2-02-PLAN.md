---
phase: 08.2-two-tier-sidebar-navigation-architecture
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - sidekiq-webapp/src/components/sidebar/sidebar-panel-chats.tsx
  - sidekiq-webapp/src/components/sidebar/sidebar-panel-sidekiqs.tsx
  - sidekiq-webapp/src/components/sidebar/sidebar-panel-teams.tsx
autonomous: true

must_haves:
  truths:
    - "Chats panel displays search input and virtualized thread list with team dropdown"
    - "Sidekiqs panel displays sidekiq list with search, create button, and click-to-chat behavior"
    - "Teams panel displays team list with create button and click-to-manage behavior"
  artifacts:
    - path: "sidekiq-webapp/src/components/sidebar/sidebar-panel-chats.tsx"
      provides: "Chats panel migrated from current sidebar expanded content"
      exports: ["SidebarPanelChats"]
    - path: "sidekiq-webapp/src/components/sidebar/sidebar-panel-sidekiqs.tsx"
      provides: "Sidekiqs panel expanded from sidebar-sidekiqs.tsx"
      exports: ["SidebarPanelSidekiqs"]
    - path: "sidekiq-webapp/src/components/sidebar/sidebar-panel-teams.tsx"
      provides: "Teams panel expanded from sidebar-teams.tsx"
      exports: ["SidebarPanelTeams"]
  key_links:
    - from: "sidebar-panel-chats.tsx"
      to: "sidebar-thread-list.tsx"
      via: "renders SidebarThreadList inside the chats panel"
      pattern: "SidebarThreadList"
    - from: "sidebar-panel-chats.tsx"
      to: "sidebar-search.tsx"
      via: "renders SidebarSearch for thread filtering"
      pattern: "SidebarSearch"
    - from: "sidebar-panel-sidekiqs.tsx"
      to: "api.sidekiq.list"
      via: "tRPC query for sidekiq data"
      pattern: "api\\.sidekiq\\.list"
---

<objective>
Create the three contextual panel content components that fill the secondary sidebar panel.

Purpose: Migrate existing sidebar content (threads, sidekiqs, teams sections) into standalone panel components. Each panel is a self-contained feature view that will be rendered inside SidebarPanel from Plan 01. These panels reuse existing sub-components (SidebarThreadList, SidebarSearch, etc.) rather than rewriting them.

Output: Three panel components ready to be wired into the SidebarPanel container.
</objective>

<execution_context>
@/Users/carlocasorzo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/carlocasorzo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08.2-two-tier-sidebar-navigation-architecture/08.2-RESEARCH.md
@.planning/phases/8.2-two-tier-sidebar-navigation/8.2-CONTEXT.md

# Existing components to migrate from
@sidekiq-webapp/src/components/sidebar/sidebar.tsx
@sidekiq-webapp/src/components/sidebar/sidebar-sidekiqs.tsx
@sidekiq-webapp/src/components/sidebar/sidebar-teams.tsx
@sidekiq-webapp/src/components/sidebar/sidebar-search.tsx
@sidekiq-webapp/src/components/sidebar/sidebar-thread-list.tsx
@sidekiq-webapp/src/components/sidebar/sidebar-header.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Chats panel component</name>
  <files>
    sidekiq-webapp/src/components/sidebar/sidebar-panel-chats.tsx
  </files>
  <action>
    Create `sidebar-panel-chats.tsx` -- "use client" component.

    This panel extracts the "expanded sidebar" content from the current `sidebar.tsx` into a standalone panel. It composes existing components:

    **Structure (top to bottom):**

    1. **Panel header:** A simple header row with:
       - Title "Chats" in `text-sm font-semibold text-sidebar-foreground`
       - The existing TeamDropdown from sidebar-header.tsx. Extract the `TeamDropdown` component into this file (or import it -- see below). The team dropdown allows filtering by team context.
       - Use `px-3 pt-3 pb-2` for header spacing.

    2. **Search:** Render existing `<SidebarSearch>` component with query/onQueryChange/inputRef props. Manage `searchQuery` state and `searchInputRef` ref locally in this component.

    3. **Thread list:** Render existing `<SidebarThreadList searchQuery={searchQuery} />` in a `flex-1 overflow-hidden` container.

    **TeamDropdown:** Copy the TeamDropdown component from sidebar-header.tsx into this file as a private component (not exported). It uses `useActiveTeam()` hook, renders a DropdownMenu with Personal option + team list + "Manage Teams" link. Keep the exact same implementation.

    **Props interface:**
    ```tsx
    interface SidebarPanelChatsProps {
      /** Ref for search input -- for Cmd+K shortcut focus */
      searchInputRef?: React.RefObject<HTMLInputElement | null>;
    }
    ```

    The searchInputRef is passed down so the parent (SidebarLayout) can wire Cmd+K to focus search in the active panel.

    Do NOT include the Sidekiqs section, Teams section, or Footer -- those are handled by the icon rail and other panels now. This panel is ONLY about chat threads.
  </action>
  <verify>
    Run `npx tsc --noEmit` from sidekiq-webapp/ -- no type errors.
    Verify SidebarPanelChats renders SidebarSearch + SidebarThreadList.
  </verify>
  <done>
    SidebarPanelChats is a self-contained panel with header (title + team dropdown), search input, and virtualized thread list. It reuses existing SidebarSearch and SidebarThreadList components.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Sidekiqs and Teams panel components</name>
  <files>
    sidekiq-webapp/src/components/sidebar/sidebar-panel-sidekiqs.tsx
    sidekiq-webapp/src/components/sidebar/sidebar-panel-teams.tsx
  </files>
  <action>
    **1. Create `sidebar-panel-sidekiqs.tsx`:**

    "use client" component. This is an expanded version of `sidebar-sidekiqs.tsx` designed to fill an entire panel rather than being a collapsible sidebar section.

    **Structure:**
    - **Header row** (`px-3 pt-3 pb-2`): Title "Sidekiqs" (`text-sm font-semibold text-sidebar-foreground`) + Create button (Plus icon, links to `/sidekiqs/new`).
    - **Search input:** A local search input for filtering sidekiqs by name. Use the same `SidebarSearch` component pattern but with placeholder "Search sidekiqs...". Manage local `searchQuery` state. Filter sidekiqs using Fuse.js with threshold 0.4 (same pattern as thread search).
    - **Sidekiq list:** `flex-1 overflow-auto` scrollable area. Show ALL sidekiqs (not limited to 5 like the current sidebar section). Display favorites first (Star icon), then recent by lastUsedAt. Each item shows SidekiqAvatar + name + optional star. Include the hover dropdown menu for "Edit Sidekiq" (same pattern from sidebar-sidekiqs.tsx). Clicking a sidekiq navigates to `/chat?sidekiq={id}`.
    - **Empty state:** "No sidekiqs yet" with Create button CTA (same pattern as sidebar-sidekiqs.tsx empty state).
    - **Loading state:** 5 skeleton rows.
    - **"See all" link at bottom:** Link to `/sidekiqs` page for full management view.

    Use `api.sidekiq.list.useQuery()` for data. Import SidekiqAvatar from sidekiq components.

    **2. Create `sidebar-panel-teams.tsx`:**

    "use client" component. This is an expanded version of `sidebar-teams.tsx` designed to fill an entire panel.

    **Structure:**
    - **Header row** (`px-3 pt-3 pb-2`): Title "Teams" (`text-sm font-semibold text-sidebar-foreground`) + Create button (Plus icon, opens TeamCreateDialog).
    - **Team list:** `flex-1 overflow-auto` scrollable area. Show all teams. Each item shows TeamAvatar + team name + member count (if available). Active team highlighted with `bg-sidebar-accent`. Clicking a team navigates to `/settings/teams?team={id}` and sets active team via `setActiveTeamId`.
    - **Empty state:** "No teams yet. Create one to start collaborating." with Create Team button.
    - **Loading state:** Return null (match existing sidebar-teams.tsx behavior).

    Use `useActiveTeam()` hook for team data. Import TeamAvatar and TeamCreateDialog.

    Manage local `createDialogOpen` state for the create dialog.
  </action>
  <verify>
    Run `npx tsc --noEmit` from sidekiq-webapp/ -- no type errors.
    Verify both panel components are importable.
  </verify>
  <done>
    SidebarPanelSidekiqs renders a full panel with header, search, scrollable list of all sidekiqs with click-to-chat. SidebarPanelTeams renders a full panel with header, team list with active highlight, and create team functionality. Both reuse existing data hooks and sub-components.
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with zero errors
- SidebarPanelChats composes SidebarSearch + SidebarThreadList + TeamDropdown
- SidebarPanelSidekiqs shows full sidekiq list (not limited to 5) with search filtering
- SidebarPanelTeams shows team list with active team highlighting
- All three panels are self-contained with their own state management
</verification>

<success_criteria>
- Three panel components created and type-checking
- Chats panel reuses existing SidebarSearch and SidebarThreadList
- Sidekiqs panel shows all sidekiqs with Fuse.js search and click-to-chat
- Teams panel shows teams with active highlighting and create dialog
- No new dependencies added -- all use existing hooks and components
</success_criteria>

<output>
After completion, create `.planning/phases/08.2-two-tier-sidebar-navigation-architecture/08.2-02-SUMMARY.md`
</output>
