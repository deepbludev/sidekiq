---
phase: 02-basic-chat-interface
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - sidekiq-webapp/package.json
  - sidekiq-webapp/src/styles/globals.css
  - sidekiq-webapp/src/app/layout.tsx
  - sidekiq-webapp/src/components/theme/theme-provider.tsx
  - sidekiq-webapp/src/components/theme/theme-toggle.tsx
  - sidekiq-webapp/src/components/ui/toggle-group.tsx
autonomous: true

must_haves:
  truths:
    - "Theme toggle switches between Light, Dark, and System modes"
    - "Theme persists across page refreshes via local storage"
    - "No flash of wrong theme on page load"
    - "Glass utility classes (.glass, .glass-subtle, .glass-input) are available"
    - "Scrollbars auto-hide and only appear when scrolling"
  artifacts:
    - path: "sidekiq-webapp/src/components/theme/theme-provider.tsx"
      provides: "next-themes wrapper for App Router"
      exports: ["ThemeProvider"]
    - path: "sidekiq-webapp/src/components/theme/theme-toggle.tsx"
      provides: "Segmented control with Sun/Moon/Monitor icons"
      exports: ["ThemeToggle"]
    - path: "sidekiq-webapp/src/components/ui/toggle-group.tsx"
      provides: "Radix ToggleGroup styled component"
      exports: ["ToggleGroup", "ToggleGroupItem"]
  key_links:
    - from: "sidekiq-webapp/src/app/layout.tsx"
      to: "sidekiq-webapp/src/components/theme/theme-provider.tsx"
      via: "wraps children with ThemeProvider"
      pattern: "<ThemeProvider"
    - from: "sidekiq-webapp/src/components/theme/theme-toggle.tsx"
      to: "next-themes"
      via: "useTheme hook"
      pattern: "useTheme"
---

<objective>
Set up the theme system and glassmorphism foundation for the entire application.

Purpose: Establish the visual foundation that all chat UI components will build upon. The theme toggle enables user preference, while glassmorphism utilities provide the modern SaaS aesthetic specified in CONTEXT.md.

Output:
- ThemeProvider wrapping the app with next-themes
- ThemeToggle segmented control component (Light/Dark/System)
- Glassmorphism CSS utility classes in globals.css
- Auto-hiding scrollbar styles
- ToggleGroup UI component from shadcn/ui
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-basic-chat-interface/02-RESEARCH.md
@.planning/phases/02-basic-chat-interface/02-CONTEXT.md
@sidekiq-webapp/src/app/layout.tsx
@sidekiq-webapp/src/styles/globals.css
@sidekiq-webapp/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install theme and toggle dependencies</name>
  <files>
    sidekiq-webapp/package.json
  </files>
  <action>
Install the required packages:
```bash
cd sidekiq-webapp && pnpm add @radix-ui/react-toggle-group
```

Note: `next-themes` is already installed (v0.4.6).

Run shadcn to add the toggle-group component:
```bash
cd sidekiq-webapp && npx shadcn@latest add toggle-group
```

If shadcn prompts for configuration, accept defaults. This should create `src/components/ui/toggle-group.tsx`.
  </action>
  <verify>
Package.json includes `@radix-ui/react-toggle-group`.
File exists: `src/components/ui/toggle-group.tsx`.
Run `pnpm typecheck` passes.
  </verify>
  <done>ToggleGroup component installed via shadcn, dependencies added</done>
</task>

<task type="auto">
  <name>Task 2: Create ThemeProvider and ThemeToggle components</name>
  <files>
    sidekiq-webapp/src/components/theme/theme-provider.tsx
    sidekiq-webapp/src/components/theme/theme-toggle.tsx
  </files>
  <action>
Create `src/components/theme/theme-provider.tsx`:
```typescript
'use client';

import { ThemeProvider as NextThemesProvider } from 'next-themes';
import type { ThemeProviderProps } from 'next-themes';

/**
 * Theme provider wrapper for next-themes.
 * Handles dark/light/system theme detection and persistence.
 */
export function ThemeProvider({ children, ...props }: ThemeProviderProps) {
  return <NextThemesProvider {...props}>{children}</NextThemesProvider>;
}
```

Create `src/components/theme/theme-toggle.tsx`:
```typescript
'use client';

import { useEffect, useState } from 'react';
import { useTheme } from 'next-themes';
import { Sun, Moon, Monitor } from 'lucide-react';

import { ToggleGroup, ToggleGroupItem } from '@sidekiq/components/ui/toggle-group';
import { cn } from '@sidekiq/lib/utils';

/**
 * Theme toggle with segmented control showing Light/Dark/System options.
 * Uses mounted state to prevent hydration mismatch.
 */
export function ThemeToggle() {
  const [mounted, setMounted] = useState(false);
  const { theme, setTheme } = useTheme();

  // Prevent hydration mismatch by only rendering after mount
  useEffect(() => {
    setMounted(true);
  }, []);

  if (!mounted) {
    // Return placeholder with same dimensions to prevent layout shift
    return (
      <div className="h-9 w-[108px] rounded-md bg-muted/50 animate-pulse" />
    );
  }

  return (
    <ToggleGroup
      type="single"
      value={theme}
      onValueChange={(value) => {
        if (value) setTheme(value);
      }}
      className="glass-subtle rounded-lg p-1"
    >
      <ToggleGroupItem
        value="light"
        aria-label="Light mode"
        className={cn(
          'h-7 w-8 rounded-md data-[state=on]:bg-background data-[state=on]:shadow-sm',
          'transition-all duration-200'
        )}
      >
        <Sun className="h-4 w-4" />
      </ToggleGroupItem>
      <ToggleGroupItem
        value="dark"
        aria-label="Dark mode"
        className={cn(
          'h-7 w-8 rounded-md data-[state=on]:bg-background data-[state=on]:shadow-sm',
          'transition-all duration-200'
        )}
      >
        <Moon className="h-4 w-4" />
      </ToggleGroupItem>
      <ToggleGroupItem
        value="system"
        aria-label="System preference"
        className={cn(
          'h-7 w-8 rounded-md data-[state=on]:bg-background data-[state=on]:shadow-sm',
          'transition-all duration-200'
        )}
      >
        <Monitor className="h-4 w-4" />
      </ToggleGroupItem>
    </ToggleGroup>
  );
}
```
  </action>
  <verify>
Both files exist at specified paths.
`pnpm typecheck` passes.
No TypeScript errors in the components.
  </verify>
  <done>ThemeProvider and ThemeToggle components created with hydration-safe pattern</done>
</task>

<task type="auto">
  <name>Task 3: Update root layout with ThemeProvider</name>
  <files>
    sidekiq-webapp/src/app/layout.tsx
  </files>
  <action>
Update `src/app/layout.tsx` to:
1. Add `suppressHydrationWarning` to `<html>` tag (required by next-themes)
2. Wrap children with ThemeProvider
3. Configure ThemeProvider with:
   - `attribute="class"` (uses .dark class for theme)
   - `defaultTheme="system"` (respect OS preference)
   - `enableSystem` (allow system detection)
   - `disableTransitionOnChange` (prevent flash on theme switch)

```typescript
import "@sidekiq/styles/globals.css";

import { type Metadata } from "next";
import { Geist } from "next/font/google";
import { Toaster } from "sonner";

import { TRPCReactProvider } from "@sidekiq/trpc/react";
import { ThemeProvider } from "@sidekiq/components/theme/theme-provider";

export const metadata: Metadata = {
  title: "Sidekiq",
  description: "Premium AI chat with custom assistants",
  icons: [{ rel: "icon", url: "/favicon.ico" }],
};

const geist = Geist({
  subsets: ["latin"],
  variable: "--font-geist-sans",
});

export default function RootLayout({
  children,
}: Readonly<{ children: React.ReactNode }>) {
  return (
    <html lang="en" className={`${geist.variable}`} suppressHydrationWarning>
      <body>
        <ThemeProvider
          attribute="class"
          defaultTheme="system"
          enableSystem
          disableTransitionOnChange
        >
          <TRPCReactProvider>{children}</TRPCReactProvider>
          <Toaster richColors position="bottom-center" />
        </ThemeProvider>
      </body>
    </html>
  );
}
```

Note: Also update Toaster position to `bottom-center` per CONTEXT.md for error toasts near input.
  </action>
  <verify>
File updated with ThemeProvider wrapping.
`suppressHydrationWarning` present on html tag.
`pnpm typecheck` passes.
Run dev server: `pnpm dev` - no hydration warnings in console.
  </verify>
  <done>Root layout wrapped with ThemeProvider, Toaster positioned at bottom-center</done>
</task>

<task type="auto">
  <name>Task 4: Add glassmorphism and scrollbar utilities to globals.css</name>
  <files>
    sidekiq-webapp/src/styles/globals.css
  </files>
  <action>
Update `src/styles/globals.css` to add glassmorphism utility classes and scrollbar styling.

Add AFTER the existing `:root` and `.dark` variable blocks, BEFORE `@layer base`:

```css
/* Glassmorphism utilities */
@layer components {
  /* Primary glass effect - for major UI panels */
  .glass {
    @apply bg-white/60 dark:bg-zinc-900/60
           backdrop-blur-xl
           border border-white/20 dark:border-white/10
           shadow-lg shadow-black/5;
  }

  /* Subtle glass - for nested elements, buttons */
  .glass-subtle {
    @apply bg-white/40 dark:bg-zinc-900/40
           backdrop-blur-md
           border border-white/10 dark:border-white/5;
  }

  /* Input glass - for form fields */
  .glass-input {
    @apply bg-white/80 dark:bg-zinc-800/80
           backdrop-blur-sm
           border border-zinc-200/50 dark:border-zinc-700/50;
  }
}

/* Auto-hiding scrollbars */
@layer base {
  /* Webkit browsers (Chrome, Safari, Edge) */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  ::-webkit-scrollbar-track {
    background: transparent;
  }

  ::-webkit-scrollbar-thumb {
    background: oklch(0.5 0 0 / 0.3);
    border-radius: 4px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: oklch(0.5 0 0 / 0.5);
  }

  .dark ::-webkit-scrollbar-thumb {
    background: oklch(0.7 0 0 / 0.3);
  }

  .dark ::-webkit-scrollbar-thumb:hover {
    background: oklch(0.7 0 0 / 0.5);
  }

  /* Firefox */
  * {
    scrollbar-width: thin;
    scrollbar-color: oklch(0.5 0 0 / 0.3) transparent;
  }

  .dark * {
    scrollbar-color: oklch(0.7 0 0 / 0.3) transparent;
  }
}
```

The existing `@layer base` block with border and body styles should remain unchanged.
  </action>
  <verify>
CSS file updated with new utility classes.
Run `pnpm dev` - no CSS syntax errors.
Test in browser: elements with `.glass` class show translucent background with blur.
Scrollbars should be thin and subtle.
  </verify>
  <done>Glassmorphism utilities and auto-hiding scrollbar styles added to globals.css</done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` passes
2. `pnpm check` (lint + typecheck) passes
3. ThemeProvider wraps app in layout.tsx
4. ThemeToggle renders without hydration mismatch
5. Clicking toggle changes theme (Light/Dark/System)
6. Theme persists after page refresh
7. No flash of wrong theme on initial load
8. `.glass`, `.glass-subtle`, `.glass-input` classes work in browser
9. Scrollbars are thin and auto-hide
</verification>

<success_criteria>
- ThemeProvider wraps application with suppressHydrationWarning on html
- ThemeToggle shows Light/Dark/System options with icons
- Theme changes apply instantly (class="dark" on html)
- Theme persists in localStorage
- Glassmorphism utility classes available and working
- No hydration mismatch errors in console
- Scrollbars styled to be subtle and auto-hiding
</success_criteria>

<output>
After completion, create `.planning/phases/02-basic-chat-interface/02-01-SUMMARY.md`
</output>
