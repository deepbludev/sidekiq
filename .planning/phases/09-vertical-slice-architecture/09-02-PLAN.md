---
phase: 09-vertical-slice-architecture
plan: 02
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - sidekiq-webapp/src/shared/ui/ (27 files)
  - sidekiq-webapp/src/shared/icons/provider-icons.tsx
  - sidekiq-webapp/src/shared/theme/theme-provider.tsx
  - sidekiq-webapp/src/shared/theme/theme-toggle.tsx
  - sidekiq-webapp/src/shared/layout/sidebar-layout.tsx
  - sidekiq-webapp/src/shared/layout/sidebar-icon-rail.tsx
  - sidekiq-webapp/src/shared/layout/sidebar-panel.tsx
  - sidekiq-webapp/src/shared/layout/sidebar-mobile-overlay.tsx
  - sidekiq-webapp/src/shared/layout/sidebar-mobile-tabs.tsx
  - sidekiq-webapp/src/shared/layout/sidebar-search.tsx
autonomous: true

must_haves:
  truths:
    - "All shadcn/ui primitives are importable from @sidekiq/ui/* paths"
    - "Theme provider and toggle work from their new shared/theme/ location"
    - "Sidebar layout shell composes correctly from shared/layout/"
    - "All components that import UI primitives resolve via new aliases"
  artifacts:
    - path: "sidekiq-webapp/src/shared/ui/button.tsx"
      provides: "Button component (most imported UI primitive)"
    - path: "sidekiq-webapp/src/shared/layout/sidebar-layout.tsx"
      provides: "Sidebar composition shell"
    - path: "sidekiq-webapp/src/shared/theme/theme-provider.tsx"
      provides: "Theme context provider"
    - path: "sidekiq-webapp/src/shared/icons/provider-icons.tsx"
      provides: "AI provider icon components"
  key_links:
    - from: "all feature components"
      to: "sidekiq-webapp/src/shared/ui/*"
      via: "@sidekiq/ui/* imports"
      pattern: "from \"@sidekiq/ui/"
    - from: "sidekiq-webapp/src/shared/ui/*.tsx"
      to: "sidekiq-webapp/src/shared/lib/utils.ts"
      via: "cn() utility import"
      pattern: "from \"@sidekiq/shared/lib/utils\""
---

<objective>
Move all shared client-side code (UI primitives, icons, theme, sidebar layout shell) to `src/shared/` and update every import across the codebase.

Purpose: The 27 shadcn/ui components, icons, theme, and sidebar layout shell are imported by nearly every feature. Moving them to shared/ establishes the design system layer that all features will import from.
Output: All shared client-side code under `src/shared/`, all imports updated to use `@sidekiq/ui/*`, `@sidekiq/shared/icons/*`, `@sidekiq/shared/theme/*`, `@sidekiq/shared/layout/*` paths.
</objective>

<execution_context>
@/Users/carlocasorzo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/carlocasorzo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/09-vertical-slice-architecture/09-CONTEXT.md
@.planning/phases/09-vertical-slice-architecture/09-RESEARCH.md
@.planning/phases/09-vertical-slice-architecture/09-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Move UI primitives, icons, and theme to shared/</name>
  <files>
    sidekiq-webapp/src/shared/ui/ (27 files)
    sidekiq-webapp/src/shared/icons/provider-icons.tsx
    sidekiq-webapp/src/shared/theme/theme-provider.tsx
    sidekiq-webapp/src/shared/theme/theme-toggle.tsx
  </files>
  <action>
Move all shadcn/ui component files from `src/components/ui/` to `src/shared/ui/` using `git mv`. These are 27 files:

```bash
cd sidekiq-webapp/src
# Move all UI primitives
git mv components/ui/alert-dialog.tsx shared/ui/alert-dialog.tsx
git mv components/ui/avatar.tsx shared/ui/avatar.tsx
git mv components/ui/badge.tsx shared/ui/badge.tsx
git mv components/ui/breadcrumb.tsx shared/ui/breadcrumb.tsx
git mv components/ui/button.tsx shared/ui/button.tsx
git mv components/ui/card.tsx shared/ui/card.tsx
git mv components/ui/checkbox.tsx shared/ui/checkbox.tsx
git mv components/ui/collapsible.tsx shared/ui/collapsible.tsx
git mv components/ui/command.tsx shared/ui/command.tsx
git mv components/ui/context-menu.tsx shared/ui/context-menu.tsx
git mv components/ui/dialog.tsx shared/ui/dialog.tsx
git mv components/ui/dropdown-menu.tsx shared/ui/dropdown-menu.tsx
git mv components/ui/form.tsx shared/ui/form.tsx
git mv components/ui/hover-card.tsx shared/ui/hover-card.tsx
git mv components/ui/input.tsx shared/ui/input.tsx
git mv components/ui/label.tsx shared/ui/label.tsx
git mv components/ui/popover.tsx shared/ui/popover.tsx
git mv components/ui/scroll-area.tsx shared/ui/scroll-area.tsx
git mv components/ui/separator.tsx shared/ui/separator.tsx
git mv components/ui/sheet.tsx shared/ui/sheet.tsx
git mv components/ui/skeleton.tsx shared/ui/skeleton.tsx
git mv components/ui/sonner.tsx shared/ui/sonner.tsx
git mv components/ui/tabs.tsx shared/ui/tabs.tsx
git mv components/ui/textarea.tsx shared/ui/textarea.tsx
git mv components/ui/toggle-group.tsx shared/ui/toggle-group.tsx
git mv components/ui/toggle.tsx shared/ui/toggle.tsx
git mv components/ui/tooltip.tsx shared/ui/tooltip.tsx
```

Move icons:
```bash
git mv components/icons/provider-icons.tsx shared/icons/provider-icons.tsx
```

Move theme:
```bash
git mv components/theme/theme-provider.tsx shared/theme/theme-provider.tsx
git mv components/theme/theme-toggle.tsx shared/theme/theme-toggle.tsx
```

**After moves, fix imports within the moved files themselves.** Many UI components import `cn` from `@sidekiq/lib/utils` -- this was already updated to `@sidekiq/shared/lib/utils` in Plan 01. But if any UI component imports from another UI component (e.g., `form.tsx` imports `label.tsx`), those imports likely use relative paths (`../ui/label` or `./label`) which still work since the files moved together. Verify by checking: do any UI files import other UI files via `@sidekiq/components/ui/...`? If so, update to `@sidekiq/ui/...` or relative paths.

The `theme-provider.tsx` and `theme-toggle.tsx` may import UI components -- update those imports from `@sidekiq/components/ui/...` to `@sidekiq/ui/...`.

The `provider-icons.tsx` may import from lib or UI -- update accordingly.
  </action>
  <verify>
Run `cd sidekiq-webapp && npx tsc --noEmit 2>&1 | head -50` to see if moved files themselves compile. Many other files will still have broken imports (they reference `@sidekiq/components/ui/...`) -- those are fixed in Task 2.
  </verify>
  <done>
All 27 UI primitives live in `src/shared/ui/`. Icons in `src/shared/icons/`. Theme in `src/shared/theme/`. Internal imports within moved files are correct.
  </done>
</task>

<task type="auto">
  <name>Task 2: Move sidebar layout shell + fix ALL codebase imports for shared client code</name>
  <files>
    sidekiq-webapp/src/shared/layout/sidebar-layout.tsx
    sidekiq-webapp/src/shared/layout/sidebar-icon-rail.tsx
    sidekiq-webapp/src/shared/layout/sidebar-panel.tsx
    sidekiq-webapp/src/shared/layout/sidebar-mobile-overlay.tsx
    sidekiq-webapp/src/shared/layout/sidebar-mobile-tabs.tsx
    sidekiq-webapp/src/shared/layout/sidebar-search.tsx
    + all files importing from components/ui/, components/icons/, components/theme/, components/sidebar/ (layout shell)
  </files>
  <action>
1. Move sidebar layout shell components (NOT feature-specific sidebar panels):
```bash
cd sidekiq-webapp/src
git mv components/sidebar/sidebar-layout.tsx shared/layout/sidebar-layout.tsx
git mv components/sidebar/sidebar-icon-rail.tsx shared/layout/sidebar-icon-rail.tsx
git mv components/sidebar/sidebar-panel.tsx shared/layout/sidebar-panel.tsx
git mv components/sidebar/sidebar-mobile-overlay.tsx shared/layout/sidebar-mobile-overlay.tsx
git mv components/sidebar/sidebar-mobile-tabs.tsx shared/layout/sidebar-mobile-tabs.tsx
git mv components/sidebar/sidebar-search.tsx shared/layout/sidebar-search.tsx
```

Do NOT move these sidebar panel files (they are feature-specific and move in later plans):
- `sidebar-panel-chats.tsx` -> moves to features/chats/ in Plan 03
- `sidebar-panel-sidekiqs.tsx` -> moves to features/sidekiqs/ in Plan 04
- `sidebar-panel-teams.tsx` -> moves to features/workspace/ in Plan 05
- `sidebar-thread-list.tsx` -> moves to features/chats/ in Plan 03
- `sidebar-thread-group.tsx` -> moves to features/chats/ in Plan 03

Also move or remove the sidebar barrel file (`components/sidebar/index.ts`) if it exists. The layout components are now in `shared/layout/`.

2. Fix imports within the moved layout files. They likely import:
   - UI components: `@sidekiq/components/ui/...` -> `@sidekiq/ui/...`
   - Other sidebar components: use relative paths for siblings in `shared/layout/`, and update references to feature panels (which are still at their old locations until Plans 03-05).
   - lib/utils: already `@sidekiq/shared/lib/utils` from Plan 01
   - hooks: these are still at `src/hooks/` -- leave those imports as-is (they use the fallback alias)

3. Fix ALL remaining imports across the entire codebase. Run `tsc --noEmit` and fix every error. The bulk of changes are:

   **UI imports (~100+ occurrences across the codebase):**
   - `@sidekiq/components/ui/button` -> `@sidekiq/ui/button`
   - `@sidekiq/components/ui/dialog` -> `@sidekiq/ui/dialog`
   - `@sidekiq/components/ui/input` -> `@sidekiq/ui/input`
   - (same pattern for all 27 UI components)

   **Icon imports:**
   - `@sidekiq/components/icons/provider-icons` -> `@sidekiq/shared/icons/provider-icons`

   **Theme imports:**
   - `@sidekiq/components/theme/theme-provider` -> `@sidekiq/shared/theme/theme-provider`
   - `@sidekiq/components/theme/theme-toggle` -> `@sidekiq/shared/theme/theme-toggle`

   **Sidebar layout imports (from app/ layouts and other components):**
   - `@sidekiq/components/sidebar/sidebar-layout` -> `@sidekiq/shared/layout/sidebar-layout`
   - `@sidekiq/components/sidebar/sidebar-panel` -> `@sidekiq/shared/layout/sidebar-panel`
   - `@sidekiq/components/sidebar/sidebar-icon-rail` -> `@sidekiq/shared/layout/sidebar-icon-rail`
   - `@sidekiq/components/sidebar/sidebar-mobile-overlay` -> `@sidekiq/shared/layout/sidebar-mobile-overlay`
   - `@sidekiq/components/sidebar/sidebar-mobile-tabs` -> `@sidekiq/shared/layout/sidebar-mobile-tabs`
   - `@sidekiq/components/sidebar/sidebar-search` -> `@sidekiq/shared/layout/sidebar-search`
   - `@sidekiq/components/sidebar` (barrel) -> individual imports from `@sidekiq/shared/layout/...`

   **Test file imports (under tests/):**
   - `@sidekiq/components/ui/tooltip` -> `@sidekiq/ui/tooltip` (in message-actions.test.tsx)
   - `@sidekiq/components/sidebar/sidebar-panel` -> `@sidekiq/shared/layout/sidebar-panel` (in sidebar-panel.test.tsx)
   - `@sidekiq/components/sidebar/sidebar-mobile-overlay` -> `@sidekiq/shared/layout/sidebar-mobile-overlay` (in sidebar-mobile-overlay.test.tsx)
   - `@sidekiq/components/theme/theme-toggle` -> `@sidekiq/shared/theme/theme-toggle` (in theme-toggle.test.tsx)

Use `tsc --noEmit` iteratively to find and fix all broken imports. Continue until zero errors.

**Strategy for efficient bulk updates:** Use search-and-replace across the codebase:
- Find: `@sidekiq/components/ui/` Replace with: `@sidekiq/ui/`
- Find: `@sidekiq/components/icons/` Replace with: `@sidekiq/shared/icons/`
- Find: `@sidekiq/components/theme/` Replace with: `@sidekiq/shared/theme/`
- Find: `@sidekiq/components/sidebar/sidebar-layout` Replace with: `@sidekiq/shared/layout/sidebar-layout`
- (etc. for each layout component)

Do NOT replace feature-specific sidebar panel imports yet (sidebar-panel-chats, sidebar-panel-sidekiqs, sidebar-panel-teams, sidebar-thread-list, sidebar-thread-group) -- those files haven't moved.
  </action>
  <verify>
Run from `sidekiq-webapp/`:
1. `npx tsc --noEmit` -- zero errors
2. `npx vitest run` -- all unit tests pass
3. Verify `src/components/ui/` directory is empty or removed
4. Verify `src/components/theme/` directory is empty or removed
5. Verify `src/components/icons/` directory is empty or removed
6. Verify `src/shared/layout/` has 6 files (sidebar-layout, sidebar-icon-rail, sidebar-panel, sidebar-mobile-overlay, sidebar-mobile-tabs, sidebar-search)
7. Verify no imports of `@sidekiq/components/ui/` remain: `grep -r "@sidekiq/components/ui/" src/ tests/ --include="*.ts" --include="*.tsx" | wc -l` should be 0
  </verify>
  <done>
All shared client-side code (27 UI primitives, icons, theme, sidebar layout shell) lives in `src/shared/`. All ~100+ imports across the codebase updated. TypeScript compiles cleanly. All tests pass. No imports reference the old `@sidekiq/components/ui/` path.
  </done>
</task>

</tasks>

<verification>
1. `cd sidekiq-webapp && npx tsc --noEmit` -- zero errors
2. `cd sidekiq-webapp && npx vitest run` -- all tests pass
3. `grep -r "@sidekiq/components/ui/" sidekiq-webapp/src/ sidekiq-webapp/tests/ --include="*.ts" --include="*.tsx" | wc -l` returns 0
4. `grep -r "@sidekiq/components/theme/" sidekiq-webapp/src/ sidekiq-webapp/tests/ --include="*.ts" --include="*.tsx" | wc -l` returns 0
5. `grep -r "@sidekiq/components/icons/" sidekiq-webapp/src/ sidekiq-webapp/tests/ --include="*.ts" --include="*.tsx" | wc -l` returns 0
6. `ls sidekiq-webapp/src/shared/ui/ | wc -l` returns 27
7. `ls sidekiq-webapp/src/shared/layout/ | wc -l` returns 6
</verification>

<success_criteria>
- 27 UI primitives in src/shared/ui/
- 6 sidebar layout components in src/shared/layout/
- 2 theme components in src/shared/theme/
- 1 icon component in src/shared/icons/
- Zero imports referencing old @sidekiq/components/ui/ paths
- tsc --noEmit clean, vitest passes
</success_criteria>

<output>
After completion, create `.planning/phases/09-vertical-slice-architecture/09-02-SUMMARY.md`
</output>
