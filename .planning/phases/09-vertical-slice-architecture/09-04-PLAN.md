---
phase: 09-vertical-slice-architecture
plan: 04
type: execute
wave: 3
depends_on: ["09-02"]
files_modified:
  - sidekiq-webapp/src/features/sidekiqs/components/ (14 + 1 sidebar)
  - sidekiq-webapp/src/features/sidekiqs/hooks/use-sidekiq-actions.ts
  - sidekiq-webapp/src/features/sidekiqs/api/router.ts
  - sidekiq-webapp/src/features/sidekiqs/validations.ts
  - sidekiq-webapp/src/features/sidekiqs/constants/emoji-data.ts
  - sidekiq-webapp/src/features/ai/components/ (6 model-picker files)
  - sidekiq-webapp/src/features/ai/hooks/use-model-selection.ts
  - sidekiq-webapp/src/features/ai/api/ (4 lib/ai files)
  - sidekiq-webapp/src/app/(dashboard)/sidekiqs/ (page imports)
  - sidekiq-webapp/tests/unit/components/sidekiq/ (test imports)
  - sidekiq-webapp/tests/unit/components/model-picker/ (test imports)
autonomous: true

must_haves:
  truths:
    - "All Sidekiq components are importable from src/features/sidekiqs/"
    - "All model-picker components are importable from src/features/ai/"
    - "Sidekiq tRPC router lives at features/sidekiqs/api/router.ts"
    - "AI gateway, models, and title logic live at features/ai/api/"
    - "Emoji data constants owned by sidekiqs feature"
  artifacts:
    - path: "sidekiq-webapp/src/features/sidekiqs/components/sidekiq-form.tsx"
      provides: "Sidekiq create/edit form component"
    - path: "sidekiq-webapp/src/features/sidekiqs/api/router.ts"
      provides: "Sidekiq tRPC router"
    - path: "sidekiq-webapp/src/features/ai/api/gateway.ts"
      provides: "AI Gateway configuration"
    - path: "sidekiq-webapp/src/features/ai/api/models.ts"
      provides: "Model definitions and defaults"
    - path: "sidekiq-webapp/src/features/ai/components/model-picker.tsx"
      provides: "Model selection dropdown"
  key_links:
    - from: "sidekiq-webapp/src/features/sidekiqs/api/router.ts"
      to: "sidekiq-webapp/src/shared/trpc/trpc.ts"
      via: "createTRPCRouter import"
      pattern: "from \"@sidekiq/shared/trpc/trpc\""
    - from: "sidekiq-webapp/src/features/ai/api/gateway.ts"
      to: "sidekiq-webapp/src/shared/env.js"
      via: "env import for API key"
      pattern: "from \"@sidekiq/shared/env\""
---

<objective>
Move the Sidekiqs feature (custom assistants) and AI feature (model picker, gateway) into their respective feature slices.

Purpose: Sidekiqs (14 components + sidebar panel + router + validations + constants) and AI (6 components + 1 hook + 4 api files) are the second and third largest feature slices. Moving them together in one plan is efficient because they share no files and both depend only on shared/ being complete.
Output: Complete sidekiqs/ and ai/ feature slices with all components, hooks, api code, and validations.
</objective>

<execution_context>
@/Users/carlocasorzo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/carlocasorzo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/09-vertical-slice-architecture/09-CONTEXT.md
@.planning/phases/09-vertical-slice-architecture/09-RESEARCH.md
@.planning/phases/09-vertical-slice-architecture/09-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Move Sidekiqs feature (components, hooks, router, validations, constants, sidebar panel)</name>
  <files>
    sidekiq-webapp/src/features/sidekiqs/components/ (15 files)
    sidekiq-webapp/src/features/sidekiqs/hooks/use-sidekiq-actions.ts
    sidekiq-webapp/src/features/sidekiqs/api/router.ts
    sidekiq-webapp/src/features/sidekiqs/validations.ts
    sidekiq-webapp/src/features/sidekiqs/constants/emoji-data.ts
  </files>
  <action>
Move all Sidekiq-domain files. All paths relative to `sidekiq-webapp/src/`.

**Sidekiq components (14 files):**
```bash
git mv components/sidekiq/avatar-picker.tsx features/sidekiqs/components/avatar-picker.tsx
git mv components/sidekiq/color-picker.tsx features/sidekiqs/components/color-picker.tsx
git mv components/sidekiq/conversation-starters.tsx features/sidekiqs/components/conversation-starters.tsx
git mv components/sidekiq/delete-sidekiq-dialog.tsx features/sidekiqs/components/delete-sidekiq-dialog.tsx
git mv components/sidekiq/emoji-picker-popover.tsx features/sidekiqs/components/emoji-picker-popover.tsx
git mv components/sidekiq/instructions-editor.tsx features/sidekiqs/components/instructions-editor.tsx
git mv components/sidekiq/sidekiq-avatar.tsx features/sidekiqs/components/sidekiq-avatar.tsx
git mv components/sidekiq/sidekiq-card.tsx features/sidekiqs/components/sidekiq-card.tsx
git mv components/sidekiq/sidekiq-empty-state.tsx features/sidekiqs/components/sidekiq-empty-state.tsx
git mv components/sidekiq/sidekiq-form.tsx features/sidekiqs/components/sidekiq-form.tsx
git mv components/sidekiq/sidekiq-indicator.tsx features/sidekiqs/components/sidekiq-indicator.tsx
git mv components/sidekiq/sidekiq-list.tsx features/sidekiqs/components/sidekiq-list.tsx
git mv components/sidekiq/sidekiq-picker.tsx features/sidekiqs/components/sidekiq-picker.tsx
git mv components/sidekiq/sidekiq-preview.tsx features/sidekiqs/components/sidekiq-preview.tsx
git mv components/sidekiq/starter-templates.tsx features/sidekiqs/components/starter-templates.tsx
```

**Sidebar panel:**
```bash
git mv components/sidebar/sidebar-panel-sidekiqs.tsx features/sidekiqs/components/sidebar-panel-sidekiqs.tsx
```

**Hook:**
```bash
git mv hooks/use-sidekiq-actions.ts features/sidekiqs/hooks/use-sidekiq-actions.ts
```

**Router:**
```bash
git mv server/api/routers/sidekiq.ts features/sidekiqs/api/router.ts
```

**Validations:**
```bash
git mv lib/validations/sidekiq.ts features/sidekiqs/validations.ts
```

**Constants -- move emoji-data from shared/ to sidekiqs feature:**
The emoji-data.ts was moved to `shared/constants/emoji-data.ts` in Plan 01. Per the research recommendation, it belongs in the sidekiqs feature (it's used by the emoji picker in Sidekiq form). Move it:
```bash
git mv shared/constants/emoji-data.ts features/sidekiqs/constants/emoji-data.ts
```
If `shared/constants/` is now empty, remove it.

**Fix imports within moved files:**
- UI imports should already be `@sidekiq/ui/...`
- Shared lib imports should already be `@sidekiq/shared/lib/...`
- Cross-component imports within the feature: use relative paths (e.g., `./sidekiq-avatar`)
- Router imports: `@sidekiq/shared/trpc/trpc` for procedures, `@sidekiq/shared/db` for db access, `@sidekiq/shared/db/schema` for schema, relative `../validations` for validations
- Emoji-data import in emoji-picker-popover.tsx: update from `@sidekiq/shared/constants/emoji-data` to relative `../constants/emoji-data`

**Fix external importers:**
- `src/app/(dashboard)/sidekiqs/` pages: update from `@sidekiq/components/sidekiq/...` to `@sidekiq/sidekiqs/components/...`
- `src/shared/layout/sidebar-layout.tsx`: update `sidebar-panel-sidekiqs` import to `@sidekiq/sidekiqs/components/sidebar-panel-sidekiqs`
- Root tRPC router (`src/shared/trpc/root.ts`): update sidekiq router import from `@sidekiq/server/api/routers/sidekiq` to `@sidekiq/sidekiqs/api/router`
- Any chat components that reference sidekiq components (e.g., chat-header may show sidekiq indicator): update to `@sidekiq/sidekiqs/components/...`

**Fix test imports:**
- `tests/unit/components/sidekiq/delete-sidekiq-dialog.test.tsx`: `@sidekiq/components/sidekiq/...` -> `@sidekiq/sidekiqs/components/...`
- `tests/unit/components/sidekiq/sidekiq-indicator.test.tsx`: same pattern
- `tests/unit/validations/sidekiq.test.ts`: `@sidekiq/lib/validations/sidekiq` -> `@sidekiq/sidekiqs/validations`

Run `tsc --noEmit` and fix all remaining errors iteratively.
  </action>
  <verify>
1. `npx tsc --noEmit 2>&1 | grep -c "error TS"` shows 0 (or only errors from auth/user/workspace not yet moved)
2. `npx vitest run` -- sidekiq-related tests pass
3. `ls src/features/sidekiqs/components/ | wc -l` returns ~15
4. `ls src/features/sidekiqs/api/router.ts` exists
5. `ls src/features/sidekiqs/validations.ts` exists
6. `grep -r "components/sidekiq/" src/ tests/ --include="*.ts" --include="*.tsx" | wc -l` returns 0
  </verify>
  <done>
All sidekiq code in src/features/sidekiqs/. Router, validations, constants, sidebar panel, hook all co-located. No old-path imports remain.
  </done>
</task>

<task type="auto">
  <name>Task 2: Move AI feature (model-picker components, hook, gateway/models API)</name>
  <files>
    sidekiq-webapp/src/features/ai/components/ (6 files)
    sidekiq-webapp/src/features/ai/hooks/use-model-selection.ts
    sidekiq-webapp/src/features/ai/api/ (4 files)
  </files>
  <action>
Move all AI/model-picker domain files. All paths relative to `sidekiq-webapp/src/`.

**Model picker components (6 files):**
```bash
git mv components/model-picker/model-hover-card.tsx features/ai/components/model-hover-card.tsx
git mv components/model-picker/model-item.tsx features/ai/components/model-item.tsx
git mv components/model-picker/model-picker-content.tsx features/ai/components/model-picker-content.tsx
git mv components/model-picker/model-picker-trigger.tsx features/ai/components/model-picker-trigger.tsx
git mv components/model-picker/model-picker.tsx features/ai/components/model-picker.tsx
```
Also move or remove the model-picker barrel file (`components/model-picker/index.ts`) -- its exports will be handled by the ai feature barrel in Plan 06.

**Hook:**
```bash
git mv hooks/use-model-selection.ts features/ai/hooks/use-model-selection.ts
```

**AI library code (4 files -> features/ai/api/):**
```bash
git mv lib/ai/gateway.ts features/ai/api/gateway.ts
git mv lib/ai/models.ts features/ai/api/models.ts
git mv lib/ai/models-metadata.ts features/ai/api/models-metadata.ts
git mv lib/ai/title.ts features/ai/api/title.ts
```

**Fix imports within moved files:**
- Model picker components import from each other: use relative paths (`./model-item`, `./model-hover-card`)
- Model picker components import from lib/ai/models-metadata: update to relative `../api/models-metadata` or `@sidekiq/ai/api/models-metadata`
- use-model-selection hook imports from lib/ai/models: update to `../api/models` or `@sidekiq/ai/api/models`
- gateway.ts imports env: should be `@sidekiq/shared/env`
- models.ts / models-metadata.ts: update any internal cross-references to relative paths
- title.ts imports from gateway: update to relative `./gateway`

**Fix external importers:**
- `src/app/api/chat/route.ts`: imports gateway.ts, models.ts, title.ts -- update from `@sidekiq/lib/ai/...` to `@sidekiq/ai/api/...`
- Chat components that use model-picker: update from `@sidekiq/components/model-picker/...` to `@sidekiq/ai/components/...`
- Any file importing from `@sidekiq/hooks/use-model-selection`: update to `@sidekiq/ai/hooks/use-model-selection`

**Fix test imports:**
- `tests/unit/components/model-picker/model-picker-trigger.test.tsx`: `@sidekiq/components/model-picker/...` -> `@sidekiq/ai/components/...`
- `tests/unit/hooks/use-model-selection.test.ts`: `@sidekiq/hooks/use-model-selection` -> `@sidekiq/ai/hooks/use-model-selection`
- `tests/unit/lib/ai/models.test.ts`: `@sidekiq/lib/ai/models` -> `@sidekiq/ai/api/models`
- `tests/unit/lib/ai/models-metadata.test.ts`: `@sidekiq/lib/ai/models-metadata` -> `@sidekiq/ai/api/models-metadata`
- `tests/unit/validations/chat.test.ts` may import DEFAULT_MODEL from `@sidekiq/lib/ai/models` -> update to `@sidekiq/ai/api/models`

Run `tsc --noEmit` and `vitest run`. Fix all errors.
  </action>
  <verify>
1. `npx tsc --noEmit` -- zero errors (or only auth/user/workspace not yet moved)
2. `npx vitest run` -- all tests pass
3. `ls src/features/ai/components/ | wc -l` returns 5 (excluding barrel)
4. `ls src/features/ai/api/ | wc -l` returns 4
5. `ls src/features/ai/hooks/` shows use-model-selection.ts
6. `grep -r "components/model-picker/" src/ tests/ --include="*.ts" --include="*.tsx" | wc -l` returns 0
7. `grep -r "lib/ai/" src/ tests/ --include="*.ts" --include="*.tsx" | wc -l` returns 0
  </verify>
  <done>
All AI/model-picker code in src/features/ai/. Model picker components, selection hook, gateway, models, and title all co-located. No old-path imports remain. All tests pass.
  </done>
</task>

</tasks>

<verification>
1. `cd sidekiq-webapp && npx tsc --noEmit` passes (possibly with auth/user/workspace errors)
2. `cd sidekiq-webapp && npx vitest run` -- all tests pass
3. `ls src/features/sidekiqs/components/ | wc -l` returns ~15
4. `ls src/features/ai/components/ | wc -l` returns ~5
5. `ls src/features/ai/api/ | wc -l` returns 4
6. `src/components/sidekiq/` directory empty or removed
7. `src/components/model-picker/` directory empty or removed
8. `src/lib/ai/` directory empty or removed
</verification>

<success_criteria>
- Sidekiqs feature slice: 15 components, 1 hook, 1 router, 1 validations, 1 constants
- AI feature slice: 5 components, 1 hook, 4 api files
- All imports updated across source and tests
- tsc --noEmit clean, vitest passes
</success_criteria>

<output>
After completion, create `.planning/phases/09-vertical-slice-architecture/09-04-SUMMARY.md`
</output>
