---
phase: 09-vertical-slice-architecture
plan: 05
type: execute
wave: 3
depends_on: ["09-02"]
files_modified:
  - sidekiq-webapp/src/features/auth/components/ (6 files)
  - sidekiq-webapp/src/features/auth/api/ (4 better-auth files)
  - sidekiq-webapp/src/features/auth/validations.ts
  - sidekiq-webapp/src/features/user/api/router.ts
  - sidekiq-webapp/src/features/user/validations.ts
  - sidekiq-webapp/src/features/user/hooks/use-view-preference.ts
  - sidekiq-webapp/src/features/workspace/components/ (12 + 1 sidebar)
  - sidekiq-webapp/src/features/workspace/hooks/ (2 files)
  - sidekiq-webapp/src/features/workspace/api/router.ts
  - sidekiq-webapp/src/features/workspace/validations.ts
  - sidekiq-webapp/src/features/workspace/lib/permissions.ts
  - sidekiq-webapp/src/features/workspace/api/emails.ts
  - sidekiq-webapp/src/features/billing/index.ts
  - sidekiq-webapp/src/app/(auth)/ (page imports)
  - sidekiq-webapp/src/app/(dashboard)/settings/ (page imports)
  - sidekiq-webapp/tests/ (test imports for auth, user, team)
autonomous: true

must_haves:
  truths:
    - "Auth components are importable from src/features/auth/"
    - "Better-auth server config lives at features/auth/api/"
    - "User tRPC router lives at features/user/api/router.ts"
    - "All team/workspace components are in features/workspace/"
    - "Team tRPC router lives at features/workspace/api/router.ts"
    - "Team permissions logic is co-located with workspace feature"
    - "Billing feature has a placeholder barrel file"
  artifacts:
    - path: "sidekiq-webapp/src/features/auth/api/server.ts"
      provides: "Better-auth server instance"
    - path: "sidekiq-webapp/src/features/auth/api/client.ts"
      provides: "Better-auth client instance"
    - path: "sidekiq-webapp/src/features/user/api/router.ts"
      provides: "User tRPC router"
    - path: "sidekiq-webapp/src/features/workspace/api/router.ts"
      provides: "Team/workspace tRPC router"
    - path: "sidekiq-webapp/src/features/workspace/lib/permissions.ts"
      provides: "Team permission checking logic"
    - path: "sidekiq-webapp/src/features/billing/index.ts"
      provides: "Billing feature placeholder"
  key_links:
    - from: "sidekiq-webapp/src/features/auth/api/config.ts"
      to: "sidekiq-webapp/src/shared/db"
      via: "database connection for auth"
      pattern: "from \"@sidekiq/shared/db\""
    - from: "sidekiq-webapp/src/features/workspace/api/router.ts"
      to: "sidekiq-webapp/src/shared/trpc/trpc.ts"
      via: "createTRPCRouter import"
      pattern: "from \"@sidekiq/shared/trpc/trpc\""
    - from: "sidekiq-webapp/src/app/api/auth/[...all]/route.ts"
      to: "sidekiq-webapp/src/features/auth/api/"
      via: "auth handler import"
      pattern: "from \"@sidekiq/auth/"
---

<objective>
Move the remaining four feature slices (auth, user, workspace, billing) into their directories under `src/features/`.

Purpose: Auth (6 components + 4 server files + validations), User (1 router + 1 hook + validations), Workspace (12 components + 2 hooks + router + validations + permissions + emails + sidebar panel), and Billing (placeholder). These are smaller features that can be efficiently moved together in one plan.
Output: Complete auth/, user/, workspace/, and billing/ feature slices.
</objective>

<execution_context>
@/Users/carlocasorzo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/carlocasorzo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/09-vertical-slice-architecture/09-CONTEXT.md
@.planning/phases/09-vertical-slice-architecture/09-RESEARCH.md
@.planning/phases/09-vertical-slice-architecture/09-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Move auth and user features</name>
  <files>
    sidekiq-webapp/src/features/auth/components/ (6 files)
    sidekiq-webapp/src/features/auth/api/ (4 files)
    sidekiq-webapp/src/features/auth/validations.ts
    sidekiq-webapp/src/features/user/api/router.ts
    sidekiq-webapp/src/features/user/validations.ts
    sidekiq-webapp/src/features/user/hooks/use-view-preference.ts
  </files>
  <action>
Move all auth and user domain files. All paths relative to `sidekiq-webapp/src/`.

**Auth components (6 files):**
```bash
git mv components/auth/auth-card.tsx features/auth/components/auth-card.tsx
git mv components/auth/forgot-password-form.tsx features/auth/components/forgot-password-form.tsx
git mv components/auth/oauth-buttons.tsx features/auth/components/oauth-buttons.tsx
git mv components/auth/reset-password-form.tsx features/auth/components/reset-password-form.tsx
git mv components/auth/sign-in-form.tsx features/auth/components/sign-in-form.tsx
git mv components/auth/sign-up-form.tsx features/auth/components/sign-up-form.tsx
```

**Auth server files (4 files) -- better-auth infrastructure:**
```bash
git mv server/better-auth/client.ts features/auth/api/client.ts
git mv server/better-auth/config.ts features/auth/api/config.ts
git mv server/better-auth/index.ts features/auth/api/index.ts
git mv server/better-auth/server.ts features/auth/api/server.ts
```

**Auth validations:**
```bash
git mv lib/validations/auth.ts features/auth/validations.ts
```

**User router:**
```bash
git mv server/api/routers/user.ts features/user/api/router.ts
```

**User validations:**
```bash
git mv lib/validations/user.ts features/user/validations.ts
```

**User hook:**
```bash
git mv hooks/use-view-preference.ts features/user/hooks/use-view-preference.ts
```

**Fix imports within moved auth files:**
- Auth components: update internal cross-references to relative paths (e.g., `./auth-card`)
- Auth components import UI: should already be `@sidekiq/ui/...`
- `config.ts`: imports from `@sidekiq/server/db` -> `@sidekiq/shared/db`
- `server.ts` / `index.ts`: update internal relative imports between auth api files
- `client.ts`: typically standalone, check for any path updates
- Auth validations: standalone Zod schemas, likely no internal deps

**Fix imports within moved user files:**
- Router: `@sidekiq/server/api/trpc` -> `@sidekiq/shared/trpc/trpc`, `@sidekiq/server/db` -> `@sidekiq/shared/db`, `@sidekiq/lib/validations/user` -> relative `../validations`
- Validations: standalone Zod schemas
- Hook: check for any server/lib imports

**Fix external importers:**
- `src/app/api/auth/[...all]/route.ts`: imports better-auth handler from `@sidekiq/server/better-auth` -> `@sidekiq/auth/api` (check exact import path)
- `src/app/(auth)/*.tsx` pages: update from `@sidekiq/components/auth/...` to `@sidekiq/auth/components/...`
- `src/shared/trpc/trpc.ts`: may import from better-auth for session validation -> update to `@sidekiq/auth/api/...`
- `src/middleware.ts`: may import from better-auth -> update to `@sidekiq/auth/api/...`
- Root tRPC router: update user router import from `@sidekiq/server/api/routers/user` to `@sidekiq/user/api/router`
- Any component using `use-view-preference`: update from `@sidekiq/hooks/use-view-preference` to `@sidekiq/user/hooks/use-view-preference`

**Fix test imports:**
- `tests/unit/validations/auth.test.ts`: `@sidekiq/lib/validations/auth` -> `@sidekiq/auth/validations`
- `tests/unit/validations/user.test.ts`: `@sidekiq/lib/validations/user` -> `@sidekiq/user/validations`
- `tests/unit/components/team/team-avatar.test.tsx`: not affected yet (team moves in Task 2)

Run `tsc --noEmit` and fix all errors iteratively.
  </action>
  <verify>
1. `npx tsc --noEmit 2>&1 | head -20` -- should show minimal errors (only from workspace not yet moved)
2. `npx vitest run` -- auth and user tests pass
3. `ls src/features/auth/components/ | wc -l` returns 6
4. `ls src/features/auth/api/ | wc -l` returns 4
5. `ls src/features/user/api/router.ts` exists
6. `grep -r "components/auth/" src/ tests/ --include="*.ts" --include="*.tsx" | wc -l` returns 0
7. `grep -r "server/better-auth" src/ tests/ --include="*.ts" --include="*.tsx" | wc -l` returns 0
8. `grep -r "lib/validations/auth" src/ tests/ --include="*.ts" --include="*.tsx" | wc -l` returns 0
9. `grep -r "lib/validations/user" src/ tests/ --include="*.ts" --include="*.tsx" | wc -l` returns 0
  </verify>
  <done>
Auth feature: 6 components, 4 api files, validations all in src/features/auth/. User feature: router, hook, validations in src/features/user/. All imports updated.
  </done>
</task>

<task type="auto">
  <name>Task 2: Move workspace feature + create billing placeholder</name>
  <files>
    sidekiq-webapp/src/features/workspace/components/ (13 files)
    sidekiq-webapp/src/features/workspace/hooks/ (2 files)
    sidekiq-webapp/src/features/workspace/api/router.ts
    sidekiq-webapp/src/features/workspace/api/emails.ts
    sidekiq-webapp/src/features/workspace/validations.ts
    sidekiq-webapp/src/features/workspace/lib/permissions.ts
    sidekiq-webapp/src/features/billing/index.ts
  </files>
  <action>
Move all team/workspace domain files. All paths relative to `sidekiq-webapp/src/`.

**Team components (12 files):**
```bash
git mv components/team/delete-team-dialog.tsx features/workspace/components/delete-team-dialog.tsx
git mv components/team/invite-accept-card.tsx features/workspace/components/invite-accept-card.tsx
git mv components/team/invite-member-dialog.tsx features/workspace/components/invite-member-dialog.tsx
git mv components/team/remove-member-dialog.tsx features/workspace/components/remove-member-dialog.tsx
git mv components/team/team-avatar.tsx features/workspace/components/team-avatar.tsx
git mv components/team/team-create-dialog.tsx features/workspace/components/team-create-dialog.tsx
git mv components/team/team-empty-state.tsx features/workspace/components/team-empty-state.tsx
git mv components/team/team-form.tsx features/workspace/components/team-form.tsx
git mv components/team/team-invites-list.tsx features/workspace/components/team-invites-list.tsx
git mv components/team/team-member-list.tsx features/workspace/components/team-member-list.tsx
git mv components/team/team-member-row.tsx features/workspace/components/team-member-row.tsx
git mv components/team/team-settings-section.tsx features/workspace/components/team-settings-section.tsx
```

**Sidebar panel:**
```bash
git mv components/sidebar/sidebar-panel-teams.tsx features/workspace/components/sidebar-panel-teams.tsx
```

**Hooks (2 files):**
```bash
git mv hooks/use-active-team.ts features/workspace/hooks/use-active-team.ts
git mv hooks/use-member-search.tsx features/workspace/hooks/use-member-search.tsx
```

**Router:**
```bash
git mv server/api/routers/team.ts features/workspace/api/router.ts
```

**Validations:**
```bash
git mv lib/validations/team.ts features/workspace/validations.ts
```

**Permissions:**
```bash
mkdir -p features/workspace/lib
git mv lib/team-permissions.ts features/workspace/lib/permissions.ts
```

**Emails:**
```bash
git mv lib/emails/team-invite.ts features/workspace/api/emails.ts
```

**Create billing placeholder:**
```typescript
// src/features/billing/index.ts
// Billing feature - placeholder for future implementation
// This feature slice will contain payment/subscription components, hooks, and API code
export {};
```

**Fix imports within moved workspace files:**
- Team components: internal cross-references -> relative paths
- UI imports: already `@sidekiq/ui/...`
- Router: `@sidekiq/shared/trpc/trpc`, `@sidekiq/shared/db`, `@sidekiq/shared/db/schema`, relative `../validations`
- team-permissions.ts: any imports from lib or server -> update
- team-invite.ts (now emails.ts): update any imports
- Hooks: `use-active-team.ts` may import from tRPC -> update to `@sidekiq/shared/trpc/...`

**Fix external importers:**
- `src/app/(dashboard)/settings/teams/page.tsx`: `@sidekiq/components/team/...` -> `@sidekiq/workspace/components/...`
- `src/app/invite/[token]/page.tsx`: `@sidekiq/components/team/invite-accept-card` -> `@sidekiq/workspace/components/invite-accept-card`
- `src/shared/layout/sidebar-layout.tsx`: `sidebar-panel-teams` -> `@sidekiq/workspace/components/sidebar-panel-teams`
- Root tRPC router: `@sidekiq/server/api/routers/team` -> `@sidekiq/workspace/api/router`
- Sidebar layout or panels using `use-active-team`: `@sidekiq/hooks/use-active-team` -> `@sidekiq/workspace/hooks/use-active-team`
- Any file using `@sidekiq/lib/team-permissions`: -> `@sidekiq/workspace/lib/permissions`

**Fix test imports:**
- `tests/unit/components/team/team-avatar.test.tsx`: `@sidekiq/components/team/team-avatar` -> `@sidekiq/workspace/components/team-avatar`
- `tests/unit/validations/team.test.ts`: `@sidekiq/lib/validations/team` -> `@sidekiq/workspace/validations`
- `tests/unit/lib/team-permissions.test.ts`: `@sidekiq/lib/team-permissions` -> `@sidekiq/workspace/lib/permissions`

Run `tsc --noEmit` and `vitest run`. Fix ALL remaining errors. At this point, ALL source files should have moved out of `src/components/`, `src/hooks/`, `src/server/api/routers/`, and `src/lib/` (except files that were already moved in prior plans).
  </action>
  <verify>
Run from `sidekiq-webapp/`:
1. `npx tsc --noEmit` -- zero errors
2. `npx vitest run` -- all tests pass
3. `ls src/features/workspace/components/ | wc -l` returns 13
4. `ls src/features/workspace/api/` shows router.ts and emails.ts
5. `ls src/features/workspace/lib/permissions.ts` exists
6. `ls src/features/billing/index.ts` exists
7. `grep -r "components/team/" src/ tests/ --include="*.ts" --include="*.tsx" | wc -l` returns 0
8. `grep -r "lib/validations/team" src/ tests/ --include="*.ts" --include="*.tsx" | wc -l` returns 0
9. `grep -r "lib/team-permissions" src/ tests/ --include="*.ts" --include="*.tsx" | wc -l` returns 0
10. `grep -r "server/api/routers/" src/ --include="*.ts" | wc -l` returns 0 (all routers moved)
  </verify>
  <done>
Workspace: 13 components, 2 hooks, router, validations, permissions, emails all in src/features/workspace/. Billing placeholder created. All feature routers moved out of server/api/routers/. All imports updated. All tests pass.
  </done>
</task>

</tasks>

<verification>
1. `cd sidekiq-webapp && npx tsc --noEmit` -- zero errors
2. `cd sidekiq-webapp && npx vitest run` -- ALL tests pass
3. All 4 feature slices populated:
   - `ls src/features/auth/components/ | wc -l` returns 6
   - `ls src/features/user/api/` shows router.ts
   - `ls src/features/workspace/components/ | wc -l` returns 13
   - `ls src/features/billing/index.ts` exists
4. Old directories should be empty:
   - `src/components/` should only contain empty subdirectories (or be removed)
   - `src/hooks/` should be empty (or removed)
   - `src/server/api/routers/` should be empty (all routers moved)
   - `src/lib/validations/` should be empty (all validations moved)
</verification>

<success_criteria>
- Auth: 6 components + 4 api files + validations in features/auth/
- User: router + hook + validations in features/user/
- Workspace: 13 components + 2 hooks + router + validations + permissions + emails in features/workspace/
- Billing: placeholder index.ts in features/billing/
- No imports reference old paths for any moved feature
- tsc --noEmit clean, vitest passes all tests
</success_criteria>

<output>
After completion, create `.planning/phases/09-vertical-slice-architecture/09-05-SUMMARY.md`
</output>
