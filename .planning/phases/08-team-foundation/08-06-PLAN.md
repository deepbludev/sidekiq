---
phase: 08-team-foundation
plan: 06
type: execute
wave: 4
depends_on: ["08-04"]
files_modified:
  - sidekiq-webapp/src/components/team/team-form.tsx
  - sidekiq-webapp/src/components/team/team-empty-state.tsx
  - sidekiq-webapp/src/components/team/team-create-dialog.tsx
  - sidekiq-webapp/src/app/(dashboard)/settings/teams/page.tsx
  - sidekiq-webapp/src/app/(dashboard)/settings/page.tsx
autonomous: true

must_haves:
  truths:
    - "User can create a team with name and avatar"
    - "Empty state shows 'Create your first team' CTA"
    - "Team settings page displays team management UI"
    - "Settings navigation includes Teams section"
  artifacts:
    - path: "sidekiq-webapp/src/app/(dashboard)/settings/teams/page.tsx"
      provides: "Team settings page"
      exports: ["default"]
    - path: "sidekiq-webapp/src/components/team/team-create-dialog.tsx"
      provides: "Team creation dialog"
      exports: ["TeamCreateDialog"]
  key_links:
    - from: "sidekiq-webapp/src/app/(dashboard)/settings/teams/page.tsx"
      to: "sidekiq-webapp/src/components/team/team-settings-section.tsx"
      via: "imports and renders TeamSettingsSection"
      pattern: "TeamSettingsSection"
---

<objective>
Create the team creation flow and integrate team settings into the settings page.

Purpose: Enable users to create new teams and manage existing ones from the settings page. This completes the team management UI by adding the creation dialog and settings page integration.

Output: Team creation dialog, empty state, and settings page with team management.
</objective>

<execution_context>
@/Users/carlocasorzo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/carlocasorzo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-team-foundation/08-CONTEXT.md
@.planning/phases/08-team-foundation/08-04-SUMMARY.md
@sidekiq-webapp/src/components/sidekiq/sidekiq-form.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create team form and create dialog</name>
  <files>
    sidekiq-webapp/src/components/team/team-form.tsx
    sidekiq-webapp/src/components/team/team-create-dialog.tsx
  </files>
  <action>
Create the team form and creation dialog:

**team-form.tsx:**
```typescript
"use client";

import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { z } from "zod";

import { Button } from "@sidekiq/components/ui/button";
import { Input } from "@sidekiq/components/ui/input";
import { Label } from "@sidekiq/components/ui/label";
import { AvatarPicker } from "@sidekiq/components/sidekiq/avatar-picker";
import { TeamAvatar } from "@sidekiq/components/team/team-avatar";
import type { SidekiqAvatar } from "@sidekiq/server/db/schema";

const teamFormSchema = z.object({
  name: z
    .string()
    .min(1, "Team name is required")
    .max(100, "Team name must be at most 100 characters"),
  avatar: z.object({
    type: z.enum(["initials", "emoji"]),
    color: z.string(),
    emoji: z.string().optional(),
  }),
});

export type TeamFormValues = z.infer<typeof teamFormSchema>;

interface TeamFormProps {
  defaultValues?: Partial<TeamFormValues>;
  onSubmit: (values: TeamFormValues) => Promise<void>;
  submitLabel?: string;
  isSubmitting?: boolean;
}

/**
 * Reusable team form component.
 * Used for both creating and editing teams.
 */
export function TeamForm({
  defaultValues,
  onSubmit,
  submitLabel = "Create Team",
  isSubmitting = false,
}: TeamFormProps) {
  const form = useForm<TeamFormValues>({
    resolver: zodResolver(teamFormSchema),
    defaultValues: {
      name: defaultValues?.name ?? "",
      avatar: defaultValues?.avatar ?? { type: "initials", color: "#6366f1" },
    },
    mode: "onChange",
  });

  const avatar = form.watch("avatar");
  const name = form.watch("name");

  const handleSubmit = form.handleSubmit(async (values) => {
    await onSubmit(values);
  });

  return (
    <form onSubmit={handleSubmit} className="space-y-6">
      <div className="flex items-start gap-6">
        {/* Avatar Picker */}
        <div className="space-y-2">
          <Label>Avatar</Label>
          <AvatarPicker
            value={avatar}
            onChange={(newAvatar) => form.setValue("avatar", newAvatar)}
            name={name || "Team"}
          />
        </div>

        {/* Name Input */}
        <div className="flex-1 space-y-2">
          <Label htmlFor="team-name">Team Name</Label>
          <Input
            id="team-name"
            placeholder="My awesome team"
            {...form.register("name")}
            disabled={isSubmitting}
            maxLength={100}
          />
          {form.formState.errors.name && (
            <p className="text-sm text-destructive">
              {form.formState.errors.name.message}
            </p>
          )}
        </div>
      </div>

      {/* Preview */}
      <div className="rounded-lg border bg-muted/50 p-4">
        <p className="text-sm text-muted-foreground mb-2">Preview</p>
        <div className="flex items-center gap-3">
          <TeamAvatar avatar={avatar} name={name || "Team"} size="lg" />
          <span className="font-medium">{name || "Team Name"}</span>
        </div>
      </div>

      <Button
        type="submit"
        className="w-full"
        disabled={!form.formState.isValid || isSubmitting}
      >
        {isSubmitting ? "Creating..." : submitLabel}
      </Button>
    </form>
  );
}
```

**team-create-dialog.tsx:**
```typescript
"use client";

import { useRouter } from "next/navigation";

import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
} from "@sidekiq/components/ui/dialog";
import { TeamForm, type TeamFormValues } from "@sidekiq/components/team/team-form";
import { api } from "@sidekiq/trpc/react";
import { toast } from "sonner";

interface TeamCreateDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
}

/**
 * Dialog for creating a new team.
 * Uses TeamForm component.
 */
export function TeamCreateDialog({ open, onOpenChange }: TeamCreateDialogProps) {
  const router = useRouter();
  const utils = api.useUtils();

  const createMutation = api.team.create.useMutation({
    onSuccess: (team) => {
      utils.team.list.invalidate();
      toast.success(`Team "${team.name}" created!`);
      onOpenChange(false);
      // Navigate to team settings
      router.push(`/settings/teams?team=${team.id}`);
    },
    onError: (error) => {
      toast.error(error.message);
    },
  });

  const handleSubmit = async (values: TeamFormValues) => {
    await createMutation.mutateAsync(values);
  };

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="sm:max-w-md">
        <DialogHeader>
          <DialogTitle>Create a Team</DialogTitle>
          <DialogDescription>
            Teams let you collaborate with others and share Sidekiqs.
          </DialogDescription>
        </DialogHeader>

        <TeamForm
          onSubmit={handleSubmit}
          isSubmitting={createMutation.isPending}
        />
      </DialogContent>
    </Dialog>
  );
}
```
  </action>
  <verify>Run `pnpm typecheck` to verify forms compile</verify>
  <done>
- TeamForm component with avatar picker and name input
- Preview section shows team appearance
- TeamCreateDialog wraps form in dialog
- Successful creation navigates to team settings
  </done>
</task>

<task type="auto">
  <name>Task 2: Create team empty state</name>
  <files>sidekiq-webapp/src/components/team/team-empty-state.tsx</files>
  <action>
Create the empty state component for when user has no teams:

```typescript
"use client";

import { Users, Plus } from "lucide-react";

import { Button } from "@sidekiq/components/ui/button";

interface TeamEmptyStateProps {
  onCreateTeam: () => void;
}

/**
 * Empty state for team settings when user has no teams.
 * Per CONTEXT.md: Shows illustration + "Create your first team" CTA.
 */
export function TeamEmptyState({ onCreateTeam }: TeamEmptyStateProps) {
  return (
    <div className="flex flex-col items-center justify-center py-12 px-4 text-center">
      <div className="mb-6 flex h-16 w-16 items-center justify-center rounded-full bg-primary/10">
        <Users className="h-8 w-8 text-primary" />
      </div>

      <h3 className="text-xl font-semibold mb-2">No teams yet</h3>

      <p className="text-muted-foreground mb-6 max-w-sm">
        Create a team to collaborate with others and share your custom Sidekiqs.
        Team members can access shared assistants and work together.
      </p>

      <Button onClick={onCreateTeam}>
        <Plus className="mr-2 h-4 w-4" />
        Create Your First Team
      </Button>
    </div>
  );
}
```
  </action>
  <verify>Run `pnpm typecheck` to verify component compiles</verify>
  <done>
- Empty state shows icon, message, and CTA
- Matches design pattern from Sidekiq empty state
  </done>
</task>

<task type="auto">
  <name>Task 3: Create team settings page</name>
  <files>sidekiq-webapp/src/app/(dashboard)/settings/teams/page.tsx</files>
  <action>
Create the team settings page:

```typescript
"use client";

import { useState } from "react";
import { useSearchParams } from "next/navigation";
import { Plus, ChevronDown } from "lucide-react";

import { Button } from "@sidekiq/components/ui/button";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from "@sidekiq/components/ui/dropdown-menu";
import { TeamAvatar } from "@sidekiq/components/team/team-avatar";
import { TeamSettingsSection } from "@sidekiq/components/team/team-settings-section";
import { TeamEmptyState } from "@sidekiq/components/team/team-empty-state";
import { TeamCreateDialog } from "@sidekiq/components/team/team-create-dialog";
import { api } from "@sidekiq/trpc/react";
import { authClient } from "@sidekiq/lib/auth-client";
import type { SidekiqAvatar } from "@sidekiq/server/db/schema";

/**
 * Team settings page.
 * Lists user's teams with dropdown to switch, and shows settings for selected team.
 */
export default function TeamSettingsPage() {
  const searchParams = useSearchParams();
  const selectedTeamId = searchParams.get("team");

  const [createDialogOpen, setCreateDialogOpen] = useState(false);

  const { data: session } = authClient.useSession();
  const { data: teams = [], isLoading } = api.team.list.useQuery();

  // Find selected team or default to first
  const selectedTeam = selectedTeamId
    ? teams.find((t) => t.id === selectedTeamId)
    : teams[0];

  if (isLoading) {
    return (
      <div className="flex items-center justify-center py-12">
        <div className="text-muted-foreground">Loading teams...</div>
      </div>
    );
  }

  // No teams - show empty state
  if (teams.length === 0) {
    return (
      <>
        <TeamEmptyState onCreateTeam={() => setCreateDialogOpen(true)} />
        <TeamCreateDialog
          open={createDialogOpen}
          onOpenChange={setCreateDialogOpen}
        />
      </>
    );
  }

  return (
    <div className="space-y-6">
      {/* Team Selector Header */}
      <div className="flex items-center justify-between">
        <DropdownMenu>
          <DropdownMenuTrigger asChild>
            <Button variant="outline" className="gap-2">
              {selectedTeam && (
                <>
                  <TeamAvatar
                    avatar={selectedTeam.avatar as SidekiqAvatar}
                    name={selectedTeam.name}
                    size="sm"
                  />
                  <span>{selectedTeam.name}</span>
                </>
              )}
              <ChevronDown className="h-4 w-4 text-muted-foreground" />
            </Button>
          </DropdownMenuTrigger>
          <DropdownMenuContent align="start" className="w-56">
            {teams.map((team) => (
              <DropdownMenuItem
                key={team.id}
                asChild
              >
                <a
                  href={`/settings/teams?team=${team.id}`}
                  className="flex items-center gap-2"
                >
                  <TeamAvatar
                    avatar={team.avatar as SidekiqAvatar}
                    name={team.name}
                    size="sm"
                  />
                  <span className="truncate">{team.name}</span>
                </a>
              </DropdownMenuItem>
            ))}
          </DropdownMenuContent>
        </DropdownMenu>

        <Button
          variant="outline"
          size="sm"
          onClick={() => setCreateDialogOpen(true)}
        >
          <Plus className="mr-2 h-4 w-4" />
          New Team
        </Button>
      </div>

      {/* Team Settings */}
      {selectedTeam && session?.user && (
        <TeamSettingsSection
          teamId={selectedTeam.id}
          currentUserId={session.user.id}
        />
      )}

      <TeamCreateDialog
        open={createDialogOpen}
        onOpenChange={setCreateDialogOpen}
      />
    </div>
  );
}
```
  </action>
  <verify>Run `pnpm typecheck` and navigate to /settings/teams in browser</verify>
  <done>
- Page shows team selector dropdown
- Empty state when no teams
- Create team button in header
- TeamSettingsSection renders for selected team
  </done>
</task>

<task type="auto">
  <name>Task 4: Add Teams link to settings navigation</name>
  <files>sidekiq-webapp/src/app/(dashboard)/settings/page.tsx</files>
  <action>
Check if there's already a settings page with navigation. If it exists, add a Teams link.
If no settings page exists yet, create one with basic navigation:

First, check if the settings page exists and what it looks like. Then either:

A) If settings page exists with navigation, add Teams link:
```typescript
// Add to navigation items array
{ href: "/settings/teams", label: "Teams", icon: Users }
```

B) If no settings page exists, create a simple settings layout:

```typescript
"use client";

import Link from "next/link";
import { usePathname } from "next/navigation";
import { User, Users, CreditCard, Settings } from "lucide-react";

import { cn } from "@sidekiq/lib/utils";

const settingsNav = [
  { href: "/settings", label: "Profile", icon: User, exact: true },
  { href: "/settings/teams", label: "Teams", icon: Users },
  // Future: { href: "/settings/billing", label: "Billing", icon: CreditCard },
];

export default function SettingsPage() {
  const pathname = usePathname();

  return (
    <div className="container max-w-4xl py-8">
      <h1 className="text-2xl font-bold mb-6">Settings</h1>

      <div className="flex flex-col md:flex-row gap-8">
        {/* Navigation */}
        <nav className="w-full md:w-48 space-y-1">
          {settingsNav.map((item) => {
            const isActive = item.exact
              ? pathname === item.href
              : pathname.startsWith(item.href);
            const Icon = item.icon;

            return (
              <Link
                key={item.href}
                href={item.href}
                className={cn(
                  "flex items-center gap-2 rounded-lg px-3 py-2 text-sm transition-colors",
                  isActive
                    ? "bg-primary text-primary-foreground"
                    : "text-muted-foreground hover:bg-muted hover:text-foreground"
                )}
              >
                <Icon className="h-4 w-4" />
                {item.label}
              </Link>
            );
          })}
        </nav>

        {/* Content */}
        <div className="flex-1">
          <div className="text-muted-foreground">
            Profile settings coming soon...
          </div>
        </div>
      </div>
    </div>
  );
}
```

Also create a settings layout if needed:
```typescript
// app/(dashboard)/settings/layout.tsx
import type { ReactNode } from "react";

export default function SettingsLayout({ children }: { children: ReactNode }) {
  return <div className="container max-w-4xl py-8">{children}</div>;
}
```

Note: Check existing structure first and adapt accordingly. The goal is to ensure /settings/teams is accessible via navigation.
  </action>
  <verify>Navigate to /settings and verify Teams link is visible and works</verify>
  <done>
- Settings page has navigation sidebar
- Teams link in navigation
- Navigation highlights current section
  </done>
</task>

</tasks>

<verification>
After completing all tasks:
1. `pnpm typecheck` passes
2. `pnpm build` succeeds
3. Navigate to /settings shows Teams in nav
4. Navigate to /settings/teams shows team management
5. Create team dialog works and creates team
6. Empty state displays when no teams exist
</verification>

<success_criteria>
- Team creation form with avatar picker works
- Empty state shows create CTA
- Settings navigation includes Teams
- Team settings page shows management UI
- Team selector dropdown allows switching between teams
</success_criteria>

<output>
After completion, create `.planning/phases/08-team-foundation/08-06-SUMMARY.md`
</output>
