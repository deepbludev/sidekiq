---
phase: 07-sidekiq-chat-integration
plan: 10
type: execute
wave: 1
depends_on: []
files_modified:
  - sidekiq-webapp/src/app/(dashboard)/chat/page.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Model picker resets when switching to Sidekiq with different default model"
    - "Model picker resets when switching to Sidekiq with no default model"
    - "Model picker shows correct model after Cmd+Shift+S navigation"
  artifacts:
    - path: "sidekiq-webapp/src/app/(dashboard)/chat/page.tsx"
      provides: "ChatInterface with key prop for remount on Sidekiq change"
      contains: "key={sidekiq?.id"
  key_links:
    - from: "sidekiq-webapp/src/app/(dashboard)/chat/page.tsx"
      to: "ChatInterface component instance"
      via: "React key prop forcing remount"
      pattern: "key=\\{sidekiq"
---

<objective>
Force ChatInterface remount when switching Sidekiqs via key prop.

Purpose: Fix model picker not resetting when navigating between Sidekiqs with different (or null) default models.
Output: ChatInterface receives key prop that changes with Sidekiq, forcing full component remount and state reset.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@sidekiq-webapp/src/app/(dashboard)/chat/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add key prop to ChatInterface</name>
  <files>sidekiq-webapp/src/app/(dashboard)/chat/page.tsx</files>
  <action>
Add a key prop to the ChatInterface component on line 57:

```tsx
return <ChatInterface key={sidekiq?.id ?? 'no-sidekiq'} threadId={null} sidekiq={sidekiq} />;
```

This forces React to unmount and remount the ChatInterface when:
- Switching from one Sidekiq to another (different sidekiq.id)
- Switching from a Sidekiq to no Sidekiq (sidekiq.id -> 'no-sidekiq')
- Switching from no Sidekiq to a Sidekiq ('no-sidekiq' -> sidekiq.id)

The remount causes:
- useModelSelection hook to reinitialize with fresh state
- getInitialModel() to recompute with new sidekiqDefaultModel
- All conversation starters and UI to reset properly

This is the simplest fix because:
- No changes to useModelSelection hook logic
- Works for ALL state in ChatInterface, not just model selection
- React-idiomatic solution for "reset component state on prop change"
  </action>
  <verify>
1. TypeScript compilation: `cd sidekiq-webapp && npx tsc --noEmit`
2. ESLint: `cd sidekiq-webapp && npm run lint`
  </verify>
  <done>
ChatInterface has key prop that changes based on sidekiq.id, forcing remount on Sidekiq change.
  </done>
</task>

</tasks>

<verification>
Manual testing (UAT retest):
1. Create two Sidekiqs: one with Claude default, one with GPT-4o default
2. Start new chat with first Sidekiq - model picker shows Claude
3. Press Cmd+Shift+S, select second Sidekiq - model picker should show GPT-4o
4. Create a third Sidekiq with NO default model
5. Switch to third Sidekiq - model picker should show user's default (not the previous Sidekiq's model)
</verification>

<success_criteria>
- [ ] ChatInterface has key={sidekiq?.id ?? 'no-sidekiq'} prop
- [ ] TypeScript compiles without errors
- [ ] ESLint passes
- [ ] Model picker updates correctly when switching between Sidekiqs (manual test)
</success_criteria>

<output>
After completion, create `.planning/phases/07-sidekiq-chat-integration/07-10-SUMMARY.md`
</output>
