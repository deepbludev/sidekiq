---
phase: 07-sidekiq-chat-integration
plan: 08
type: execute
wave: 1
depends_on: []
files_modified:
  - sidekiq-webapp/src/components/sidekiq/sidekiq-form.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "User can select a default model when creating a Sidekiq"
    - "User can change the default model when editing a Sidekiq"
    - "Selected model is saved to the Sidekiq and used for new chats"
  artifacts:
    - path: "sidekiq-webapp/src/components/sidekiq/sidekiq-form.tsx"
      provides: "Model picker field in Sidekiq form"
      contains: "ModelPicker"
  key_links:
    - from: "sidekiq-form.tsx"
      to: "ModelPicker component"
      via: "FormField with ModelPicker"
      pattern: "ModelPicker.*onValueChange"
    - from: "sidekiq-form.tsx"
      to: "defaultModel form field"
      via: "React Hook Form field"
      pattern: "name=\"defaultModel\""
---

<objective>
Add model selector to Sidekiq create/edit form

**Problem:** The backend schema has `defaultModel` field but the UI form doesn't expose it. Users cannot set a preferred model for their Sidekiqs.

**Solution:** Add the existing ModelPicker component to the SidekiqForm. Wire it to the `defaultModel` form field which already exists in the schema.

Purpose: Allow users to configure which AI model a Sidekiq uses by default
Output: Model picker integrated into Sidekiq form
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@sidekiq-webapp/src/components/sidekiq/sidekiq-form.tsx
@sidekiq-webapp/src/components/model-picker/model-picker.tsx
@sidekiq-webapp/src/lib/validations/sidekiq.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add ModelPicker to SidekiqForm</name>
  <files>sidekiq-webapp/src/components/sidekiq/sidekiq-form.tsx</files>
  <action>
Integrate the ModelPicker component into the Sidekiq form:

1. Add import at the top of the file:
   ```typescript
   import { ModelPicker } from "@sidekiq/components/model-picker/model-picker";
   import { DEFAULT_MODEL } from "@sidekiq/lib/ai/models-metadata";
   ```

2. Add the defaultModel to the watched values (around line 74):
   ```typescript
   const defaultModel = watchedValues.defaultModel ?? null;
   ```

3. Add a new FormField for defaultModel after the Avatar picker field (after line 203). Insert before the Description field for logical grouping:
   ```typescript
   {/* Default Model field */}
   <FormField
     control={form.control}
     name="defaultModel"
     render={({ field }) => (
       <FormItem>
         <FormLabel>Default Model</FormLabel>
         <FormControl>
           <div className="w-full">
             <ModelPicker
               value={field.value ?? DEFAULT_MODEL}
               onValueChange={(modelId) => field.onChange(modelId)}
               className="w-full justify-between"
             />
           </div>
         </FormControl>
         <FormDescription>
           Model used for new chats with this Sidekiq. Can be changed per chat.
         </FormDescription>
         <FormMessage />
       </FormItem>
     )}
   />
   ```

4. The form already has `defaultModel` in its defaultValues (line 67) as `initialData?.defaultModel ?? null`, so that's already handled.

Note: The ModelPicker component already handles the popover UI, model selection, and displays the selected model. We just need to wire it to the form field.
  </action>
  <verify>
1. TypeScript compiles: `pnpm typecheck`
2. UI renders: Navigate to `/sidekiqs/new` and verify model picker appears
3. Selection works: Click picker, select a model, verify it shows as selected
4. Form submission: Create Sidekiq with non-default model, verify it saves correctly
5. Edit flow: Edit existing Sidekiq, verify defaultModel shows correctly, change it, save
  </verify>
  <done>ModelPicker integrated into SidekiqForm, users can set default model for Sidekiqs</done>
</task>

</tasks>

<verification>
1. **Create flow:** New Sidekiq form shows model picker with default model selected
2. **Edit flow:** Edit form shows the Sidekiq's current defaultModel
3. **Persistence:** After save, Sidekiq's defaultModel is stored in database
4. **Integration:** When starting a chat with the Sidekiq, the defaultModel is used (per model selection priority: thread > sidekiq > user > default, confirmed in STATE.md)
</verification>

<success_criteria>
- Model picker visible in Sidekiq create form
- Model picker visible in Sidekiq edit form
- Selected model persists after form submission
- TypeScript compiles without errors
- Existing form functionality unaffected
</success_criteria>

<output>
After completion, create `.planning/phases/07-sidekiq-chat-integration/07-08-SUMMARY.md`
</output>
