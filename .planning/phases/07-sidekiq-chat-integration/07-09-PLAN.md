# Phase 7 Plan 9: Fix Model State on Sidekiq Switch

**Gap closure: Add useEffect to reset model selection when switching between Sidekiqs**

## Context

When navigating between Sidekiqs via client-side navigation (e.g., /chat?sidekiq=A → /chat?sidekiq=B), the model picker retains the previous Sidekiq's default model instead of updating to the new Sidekiq's default model.

**Root cause:** `useModelSelection` hook has a `useEffect` that handles `threadModel` changes (lines 128-132) but no equivalent effect for `sidekiqDefaultModel` prop changes.

## Success Criteria

- [ ] Model picker updates immediately when switching between Sidekiqs
- [ ] Existing thread model behavior preserved (thread model takes priority)
- [ ] No regression in model selection for new chats without Sidekiq

## Tasks

### Task 1: Add sidekiqDefaultModel useEffect

**File:** `sidekiq-webapp/src/hooks/use-model-selection.ts`

**Change:** Add a new `useEffect` after the existing `threadModel` effect (around line 133) to handle `sidekiqDefaultModel` prop changes.

```typescript
// Update selected model when sidekiq default model changes (navigating between sidekiqs)
useEffect(() => {
  // Only apply sidekiq default if no threadModel (new chat scenario)
  if (!threadModel && sidekiqDefaultModel && isValidModel(sidekiqDefaultModel)) {
    setSelectedModelState(sidekiqDefaultModel);
  }
}, [threadModel, sidekiqDefaultModel]);
```

**Rationale:**
- Guards with `!threadModel` to ensure thread model takes priority for existing threads
- Uses `isValidModel` for safety like the existing threadModel effect
- Dependency array includes both `threadModel` and `sidekiqDefaultModel` to respond to either change

**Commit:** `fix(model): reset model selection when switching sidekiqs`

## Verification

After applying fix:
1. Create two Sidekiqs with different default models (e.g., Claude and GPT-4o)
2. Start chat with first Sidekiq → model picker shows first model
3. Click second Sidekiq in sidebar → model picker shows second model (no refresh needed)
4. Open existing thread → model picker shows thread's model (not Sidekiq default)

## Files Modified

- `sidekiq-webapp/src/hooks/use-model-selection.ts`

---
*Phase: 07-sidekiq-chat-integration*
*Plan: 09 (gap closure)*
*Created: 2026-01-25*
