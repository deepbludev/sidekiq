---
phase: 07-sidekiq-chat-integration
plan: 05
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - sidekiq-webapp/src/components/sidebar/sidebar-sidekiqs.tsx
  - sidekiq-webapp/src/components/sidekiq/sidekiq-card.tsx
  - sidekiq-webapp/src/components/sidekiq/sidekiq-list.tsx
  - sidekiq-webapp/src/app/(dashboard)/sidekiqs/[id]/edit/page.tsx
autonomous: true

must_haves:
  truths:
    - "Sidebar Sidekiq click navigates to /chat?sidekiq={id}"
    - "Sidekiq list page has 'Start Chat' action for each Sidekiq"
    - "Edit page has 'Start Chat' button"
  artifacts:
    - path: "sidekiq-webapp/src/components/sidebar/sidebar-sidekiqs.tsx"
      provides: "Sidebar navigation to chat"
      contains: "/chat?sidekiq="
    - path: "sidekiq-webapp/src/components/sidekiq/sidekiq-card.tsx"
      provides: "Chat action on Sidekiq cards"
      contains: "Start Chat"
  key_links:
    - from: "sidekiq-webapp/src/components/sidebar/sidebar-sidekiqs.tsx"
      to: "sidekiq-webapp/src/app/(dashboard)/chat/page.tsx"
      via: "router.push navigation"
      pattern: "/chat\\?sidekiq="
---

<objective>
Chat entry points from Sidekiq UI.

Purpose: Enable starting chats with Sidekiqs from the sidebar, list page, and edit page per CONTEXT.md decisions.
Output: Modified sidebar click behavior, "Start Chat" actions on cards/list, and edit page chat button.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-sidekiq-chat-integration/07-CONTEXT.md
@sidekiq-webapp/src/components/sidebar/sidebar-sidekiqs.tsx
@sidekiq-webapp/src/components/sidekiq/sidekiq-card.tsx
@sidekiq-webapp/src/components/sidekiq/sidekiq-list.tsx
@sidekiq-webapp/src/app/(dashboard)/sidekiqs/[id]/edit/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update sidebar Sidekiq click to start chat</name>
  <files>sidekiq-webapp/src/components/sidebar/sidebar-sidekiqs.tsx</files>
  <action>
Change sidebar Sidekiq click behavior from edit to chat:

1. Update handleSidekiqClick function:
   ```typescript
   const handleSidekiqClick = (id: string) => {
     // Navigate to chat with this Sidekiq selected
     // Per CONTEXT.md: sidebar click starts new chat (not edit page)
     router.push(`/chat?sidekiq=${id}`);
     onSidekiqSelect?.();
   };
   ```

2. Remove the NOTE comment about Phase 7 since we're implementing it now

3. Add context menu with "Edit" option so users can still access edit page:
   - Import DropdownMenu components
   - Add MoreHorizontal icon button on hover
   - Dropdown with "Edit Sidekiq" option linking to /sidekiqs/{id}/edit

   ```typescript
   <div className="group relative">
     <button
       onClick={() => handleSidekiqClick(sidekiq.id)}
       className="hover:bg-accent/50 flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-left text-sm transition-colors"
     >
       <SidekiqAvatar ... />
       <span className="flex-1 truncate">{sidekiq.name}</span>
       {sidekiq.isFavorite && (
         <Star className="size-3 shrink-0 fill-amber-400 text-amber-400" />
       )}
     </button>
     {/* Edit dropdown on hover */}
     <DropdownMenu>
       <DropdownMenuTrigger asChild>
         <Button
           variant="ghost"
           size="icon"
           className="absolute right-1 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 size-6"
           onClick={(e) => e.stopPropagation()}
         >
           <MoreHorizontal className="size-3" />
         </Button>
       </DropdownMenuTrigger>
       <DropdownMenuContent align="end">
         <DropdownMenuItem asChild>
           <Link href={`/sidekiqs/${sidekiq.id}/edit`}>
             Edit Sidekiq
           </Link>
         </DropdownMenuItem>
       </DropdownMenuContent>
     </DropdownMenu>
   </div>
   ```

NOTE: The sidebar Sidekiq click now ALWAYS starts a new chat. This is intentional per CONTEXT.md - users expect fresh starts from sidebar.
  </action>
  <verify>
1. Run `pnpm tsc --noEmit` for type checking
2. Click Sidekiq in sidebar navigates to /chat?sidekiq={id}
3. Hover shows dropdown with "Edit Sidekiq" option
  </verify>
  <done>Sidebar Sidekiq click starts chat, edit accessible via dropdown menu</done>
</task>

<task type="auto">
  <name>Task 2: Add "Start Chat" action to Sidekiq cards and list items</name>
  <files>
sidekiq-webapp/src/components/sidekiq/sidekiq-card.tsx
sidekiq-webapp/src/components/sidekiq/sidekiq-list.tsx
  </files>
  <action>
Add chat entry point to Sidekiq cards on the list page:

Part A - SidekiqCard:
1. Import router from next/navigation if not already
2. Add "Start Chat" button or make the card clickable to start chat:

   Option A (dedicated button):
   ```typescript
   <Button
     variant="secondary"
     size="sm"
     className="w-full"
     onClick={() => router.push(`/chat?sidekiq=${sidekiq.id}`)}
   >
     <MessageSquare className="mr-2 h-4 w-4" />
     Start Chat
   </Button>
   ```

   Option B (card click starts chat, edit via dropdown):
   Make the entire card clickable to start chat, move edit to context menu.

3. Per CONTEXT.md, chat is available from BOTH list page AND detail page, so ensure the card has clear chat affordance.

Part B - SidekiqList (if using list view):
1. Check if there's a list view toggle (per 06-02 there's grid/list preference)
2. Add similar "Start Chat" action to list item variant
3. Ensure both views have consistent chat entry points
  </action>
  <verify>
1. Run `pnpm tsc --noEmit` for type checking
2. Sidekiq cards on /sidekiqs page have "Start Chat" button/action
3. Clicking "Start Chat" navigates to /chat?sidekiq={id}
  </verify>
  <done>Sidekiq list page has clear "Start Chat" action for each Sidekiq</done>
</task>

<task type="auto">
  <name>Task 3: Add "Start Chat" button to Sidekiq edit page</name>
  <files>sidekiq-webapp/src/app/(dashboard)/sidekiqs/[id]/edit/page.tsx</files>
  <action>
Add a "Start Chat" button to the Sidekiq edit page header:

1. Import necessary components:
   ```typescript
   import { Button } from "@sidekiq/components/ui/button";
   import { MessageSquare } from "lucide-react";
   import Link from "next/link";
   ```

2. Check the current page structure - likely has a header/breadcrumb area

3. Add "Start Chat" button in the header area:
   ```typescript
   <div className="flex items-center justify-between">
     {/* Breadcrumb or title */}
     <div>
       <Breadcrumb>...</Breadcrumb>
       <h1>Edit {sidekiq.name}</h1>
     </div>
     {/* Actions */}
     <Button asChild>
       <Link href={`/chat?sidekiq=${sidekiq.id}`}>
         <MessageSquare className="mr-2 h-4 w-4" />
         Start Chat
       </Link>
     </Button>
   </div>
   ```

4. If there's a SidekiqForm component handling the page, may need to pass sidekiqId or add button outside the form.
  </action>
  <verify>
1. Run `pnpm tsc --noEmit` for type checking
2. Edit page has visible "Start Chat" button
3. Button navigates to /chat?sidekiq={id}
  </verify>
  <done>Sidekiq edit page has "Start Chat" button in header</done>
</task>

</tasks>

<verification>
1. TypeScript compilation: `pnpm tsc --noEmit`
2. Sidebar Sidekiq click â†’ /chat?sidekiq={id}
3. List page cards have "Start Chat" action
4. Edit page has "Start Chat" button
5. All chat entry points work correctly
</verification>

<success_criteria>
- Sidebar click starts chat (edit via dropdown)
- List page has "Start Chat" on each Sidekiq
- Edit page has "Start Chat" button
- All navigation uses /chat?sidekiq={id} pattern
</success_criteria>

<output>
After completion, create `.planning/phases/07-sidekiq-chat-integration/07-05-SUMMARY.md`
</output>
